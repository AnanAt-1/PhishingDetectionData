<HTML>
<HEAD><TITLE>  Package FD  </TITLE></HEAD>
<BODY>

<H1> Fortran 77 package FD version 5.50 </H1>
<!-- ==================================   -->
<P>
<ADDRESS>
  By <B>Jiri Zahradnik</B><BR>
  Department of Geophysics, Charles University Prague<BR>
  V Holesovickach 2, 180 00 Praha 8, Czech Republic<BR>
  Tel.: +420-2-21912546, Fax: +420-2-21912555<BR>
  E-mail: jz@karel.troja.mff.cuni.cz
</ADDRESS>
<ADDRESS>
  Data input and output modified by
  <B>Vaclav Bucha</B> and <B>Ludek Klimes</B><BR>
  Department of Geophysics, Charles University Prague<BR>
  Ke Karlovu 3, 121 16  Praha 2,  Czech Republic<BR>
  E-mails: bucha@seis.karlov.mff.cuni.cz<BR>
           klimes@seis.karlov.mff.cuni.cz
</ADDRESS>
</P><P>
Package FD contains programs for 2-D P-SV elastic second-order
finite differences.
</P><P>
See file <A HREF="fdver.htm">fdver.htm</A> for the list of released
versions and changes made in this version.
</P><P>
Package FD employs package FORMS for
<A HREF="../forms/ram.inc">unified memory management</A> and
<A HREF="../forms/f.pl">unified compilation</A>.
</P><P>
All Fortran 77 source code and include files of the FD package are
assumed to be located in a single directory together with all source
code and include files of the FORMS and MODEL packages when being compiled and
linked.  The files with main programs contain, at their ends, Fortran
90 INCLUDE command for all subroutine files required.  In this way,
each program may simply be compiled and linked as a single file.
</P><P>
All filenames are assumed to be expressed in lowercase.
</P><P>
Fortran 77 source code files have extension '.for'.  The corresponding
files with specifications of the COMMON blocks have extension '.inc'
and are included in the Fortran 77 source code by means of Fortran 90
INCLUDE command.
</P>


<H2> Compiling and linking programs of package FD </H2>
<!-- =============================================   -->

<UL>
<LI> Copy all files (or at least all <TT>*.for</TT> and <TT>*.inc</TT>
     files) of package <A HREF="../forms"> FORMS </A>
     into your working directory.
     All the files may also be extracted using
     <TT>pkunzip -d <A HREF="../bin/forms.zip">forms.zip</A></TT> or
     <TT>tar -xvf <A HREF="../bin/forms.tar">forms.tar</A></TT>
     <BR>
     On a computer with a very small memory (less than 16 MB), you may
     need to decrease array dimension MRAM in the include file
     <A HREF="../forms/ram.inc"><TT>ram.inc</TT></A>.
     On a better computer (more than 16 MB), you may
     wish to increase array dimension MRAM in the include file
     <A HREF="../forms/ram.inc"><TT>ram.inc</TT></A>.
     <BR>
     It is also recommended to compile and link all programs of package
     FORMS according to the description in
     <A HREF="../forms/forms.htm">forms.htm</A>.
<LI> Copy all files (or at least all <TT>*.for</TT> and <TT>*.inc</TT>
     files) of package <A HREF="../model"> MODEL </A>
     into your working directory.
     All the files including subdirectories may also be extracted using
     <TT>pkunzip -d <A HREF="../bin/model.zip">model.zip</A></TT> or
     <TT>tar -xvf <A HREF="../bin/model.tar">model.tar</A></TT>
     <BR>
     It is also recommended to compile and link all programs of package
     MODEL according to the description in
     <A HREF="../model/model.htm">model.htm</A>.
<LI> Copy all files (or at least all <TT>*.for</TT> and <TT>*.inc</TT>
     files) of package <A HREF="">FD</A> into your working directory.
     All the files including subdirectories may also be extracted using
     <TT>pkunzip -d <A HREF="../bin/fd.zip">fd.zip</A></TT> or
     <TT>tar -xvf <A HREF="../bin/fd.tar">fd.tar</A></TT>
<LI> Now you may compile and link following programs of package FD:
     <UL>
     <LI><A HREF="modfd.for"  >modfd.for  </A>
     <LI><A HREF="fdmod.for"  >fdmod.for  </A>
     <LI><A HREF="fd2d.for"   >fd2d.for   </A>
     <LI><A HREF="newpar.for" >newpar.for </A>
     </UL>
     All necessary subroutine files and include files are included
     by the Fortran 90 <TT> INCLUDE </TT> commands located
     at the end of above listed files containing main programs.
     <BR>
     You may perform the above task by editing Perl script
     <A HREF="../forms/f.pl"><TT>f.pl</TT></A>
     designed to compile and link a single file, and then running Perl script
     <A HREF="ffd.pl"><TT>ffd.pl</TT></A> by typing command<BR>
     <TT>perl ffd.pl</TT>
     <BR>
     If you have no Perl interpreter, it should be available at
     <A HREF="http://www.perl.org">www.perl.org</A>
</UL>


<H2> Running programs of package FD </H2>
<!-- ==============================   -->

It is recommended to run the programs from the
<A HREF="../forms/sep.htm">history files</A>.
The history files may contain the information how to execute the programs,
the data read from standard input (Fortran)
or from the command line (Perl) and the data read
from the SEP parameter files.

<DL>
<DT><B>Data from standard input *:</B>
<DD>
Main input data of each program are read from the standard input
and mostly consist of a single line containing filenames and
at most few numerical parameters.
<DT><A HREF="modfd.for#data">
    Description of input data for 'modfd.for'</A>
    <DD>
    Calculating effective elastic parameters (harmonic
    averages of elastic parameters) for 2-D elastic finite differences
    in models specified by means of the MODEL package.
<DT><A HREF="fd2d.for#data">
    Description of input data for 'fd2d.for'</A>
    <DD>
    Performing 2-D P-SV elastic second-order finite differences.
<DT><A HREF="newpar.for#data">
    Description of input data for 'newpar.for'</A>
    <DD>
    Modifying the effective elastic parameters (harmonic
    averages of elastic parameters) for 2-D elastic finite differences.
<DT>Brief descriptions of Perl scripts
    <DD><A HREF="fdmax.pl"   >'fdmax.pl'</A>
    <DD><A HREF="fdpcx.pl"   >'fdpcx.pl'</A>
    <DD><A HREF="fdgifdos.pl">'fdgifdos.pl'</A>
    <DD><A HREF="fdgiflux.pl">'fdgiflux.pl'</A>
    <DD>designed to facilitate creation of wavefield movies (animated GIF).
<DT><A HREF="fd.h">
    Example of the history file to run the programs</A>
</DL>


<A HREF="../par.htm">
<H2> Alphabetical list of input parameters of all programs</A></H2>
<!-- =====================================================      -->


<A HREF="fdsnaps.htm">
<H2> Example of snapshots for the demo model</A> (1.2 MB)</H2>
<!-- =======================================               -->


<H2> List of error messages </H2>
<!-- ======================   -->

<UL>
<LI><A HREF="../forms/formserr.htm"> Package FORMS </A>
<LI><A HREF="../model/modelerr.htm"> Package MODEL </A>
<LI><A HREF="../crt/crterr.htm"    > Package CRT   </A>
<LI><A HREF="../net/neterr.htm"    > Package NET   </A>
<LI><A HREF="../fd/fderr.htm"      > Package FD    </A>
<LI><A HREF="../nr/nrerr.htm"      > Package NR    </A>
<LI><A HREF="../data/dataerr.htm"  > Package DATA  </A>
</UL>


<H2> File list of package FD </H2>
<!-- ========================   -->
<P>
Package FD consists of packages FORMS and MODEL and of the
following Fortran 77 and Perl source code and demo files:
</P>
<DL>
<DT> (A) Documentation:
<DD><DL>
<DT><B>                     fd.htm       </B><DD>
    This file  (main HTML file containing basic description and links
    the files of this package).
<DT><A HREF="fdver.htm">    fdver.htm    </A><DD>
    List of the released versions.
<DT><A HREF="fderr.htm">    fderr.htm    </A><DD>
    List of error messages with the links to their descriptions.
</DL>

<DT> (B) Fortran and Perl programs and subroutines:
<DD><DL>
<DT><A HREF="modfd.for">    modfd.for    </A><DD>
    Program to calculate effective elastic parameters (harmonic
    averages of elastic parameters) for 2-D elastic finite differences
    in models specified by means of the MODEL package.
<DT><A HREF="fdmod.for">    fdmod.for    </A><DD>
    Program to generate finite-difference effective parameters
    (harmonic averages of elastic parameters) in 2-D models specified in
    terms of homogeneous convex polygons (this backward compatibility
    is included just for test purposes).
<DT><A HREF="fd2d.for">     fd2d.for     </A><DD>
    Program for 2-D P-SV elastic second-order finite differences.
<DT><A HREF="fdaux.for">    fdaux.for    </A><DD>
    Auxiliary subroutines for FD code, reading and writing input data.
<DT><A HREF="gmtra.for">    gmtra.for    </A><DD>
    Subroutine GMTRA of the IBM Scientific Subroutine Package to
    transpose a general matrix.
<DT><A HREF="newpar.for">   newpar.for   </A><DD>
    Program NEWPAR to modify the effective elastic parameters (harmonic
    averages of elastic parameters) for 2-D elastic finite differences.
<DT><A HREF="newpar.pl">    newpar.pl    </A><DD>
    Perl-script counterpart of 'newpar.for', employing program
    'grdcal.for' of package FORMS.
<DT><A HREF="fdmax.pl">     fdmax.pl     </A><DD>
    Perl script to display the colour saturation of the snapshots.
<DT><A HREF="fdmax.pro">    fdmax.pro    </A><DD>
    Auxiliary PostScript file to 'fdmax.pl'.
</DL>

<DT> (C) General-purpose scripts and data files
<DD><DL>
<DT><A HREF="fdpcx.pl">     fdpcx.pl     </A><DD>
    Perl script to convert PostScript snapshots into PCX format
    using program GhostScript.
<DT><A HREF="fdpcx.bat">    fdpcx.bat    </A><DD>
    MS-DOS batch file to speed up execution of 'fdpcx.pl' using
    RAM disk.
<DT><A HREF="fdgiflux.pl">  fdgiflux.pl  </A><DD>
    Perl script to convert PCX snapshots into GIF (just for Linux).
<DT><A HREF="fdgifdos.pl">  fdgifdos.pl  </A><DD>
    Perl script to convert PCX snapshots into GIF (just for MS-DOS).
<DT><A HREF="ffd.pl">       ffd.pl       </A><DD>
    Perl script to compile the FD package by means of
    predefined script 'f.pl' compiling and linking a single
    Fortran 77 source code file.
<DT><A HREF="snapdiv.cal">  snapdiv.cal  </A><DD>
<DT><A HREF="snaprot.cal">  snaprot.cal  </A><DD>
<DT><A HREF="snap.cal">     snap.cal     </A><DD>
    Input command files for program 'grdcal.for' to transform
    displacement snapshots into normalized divergence and rotation
    and, finally, into norm and angle for plotting by program
    'grdps.for'.
</DL>

<DT> (D) Demo data:
<DD><DL>
<DT><A HREF="fd.h">         fd.h         </A><DD>
    History file with demo data for 2-D FD.  It may be executed
    by command 'perl go.pl fd.h'.
<DT><A HREF="modfd.dat">    modfd.dat    </A><DD>
    Input data for package MODEL specifying the demo model for
    2-D elastic finite differences.
<DT><A HREF="fdmod.dat">    fdmod.dat    </A><DD>
    Input data for program 'fdmod.for' specifying the same demo model
    for 2-D elastic finite differences (just for test purposes).
<DT><A HREF="fdsrc.dat">    fdsrc.dat    </A><DD>
    Source coordinates.
<DT><A HREF="fdrec.dat">    fdrec.dat    </A><DD>
    Receiver coordinates.
<DT><A HREF="addrec.cal">   addrec.cal   </A><DD>
    Script for 'grdcal.for' to overlay snapshots with receiver positions.
<DT><A HREF="modfdps.h">    modfdps.h    </A><DD>
    History file to plot the effective elastic parameters calculated
    by program 'modfd.for' in the demo model.
</DL>

<DT> (E) Comparison with ray-theory seismograms in particular models:
<DD>
    Note that package CRT is required for the comparison.
    Since the history files for FD require the same data files
    with receiver and source coordinates as the ray tracing history
    files, they are located together with referred data files
    in the respective subdirectories of the CRT package.
<DD><DL>
<DT><A HREF="../data/rm/rm-fd.h">   rm-fd.h  </A><DD>
    1-D model RM to test the ray-matrix method.
<DT><A HREF="../data/u2d/u2d-fd.h"> u2d-fd.h </A><DD>
    2-D model UNCONFORMITY (Cormier and Mellen 1984).
</DL>

<DT> (F) Pictures:
<DD><DL>
<DT><A HREF="fdsnaps.htm">  fdsnaps.htm  </A><DD>
    HTML link to the example of snapshots for the demo model.
<DT><A HREF="fdcolor.ps">   fdcolor.ps   </A><DD>
    PostScript diagram showing colours used to display snapshots.
<DT><A HREF="fdcolor.bat">  fdcolor.bat  </A><DD>
    MS-DOS batch file to convert 'fdcolor.ps' into PCX format
    using program GhostScript.
</DL>
</DL>


<H2> Acknowledgements </H2>
<!-- ================   -->
<P>
The development of this package has been partially supported by:
</P>
<UL>
<LI>Faculty of Mathematics and Physics, Charles University, Prague.
<LI>Members of consortium 'Seismic Waves in Complex 3-D Structures'.
</UL>


</BODY>
<!-- Last updates: -->
<!-- 04.06.01 P.B. -->
<!-- 08.06.01 L.K. -->
</HTML>
