<!doctype html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<base href="https://www.powpics.info/"/>
<!-- <base href="http://localhost/powpics/"/> -->
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="author" content="Mark T Collins"/>
<title>POWPics</title>
<meta name="keywords" content="postcard photograph church temple religion photograph deltiology collection images topographic architecture" />
<meta name="description" content="Roughwood Pictures of Places of Worship Collection" />
<meta name="robots" content="all" />

<meta property="og:title" content="POWPics - Roughwood Places of Worship Image Collection" />
<meta property="og:description" content="A database of places of worship with photographs taken by Mark Collins as well as vintage postcard images." />
<meta property="og:type" content="website" />

<link rel="icon" type="image/png" sizes="64x64" href="image/Church64.png"/>
<link rel="stylesheet" href="scripts/jstree/themes/default/style.css" media="screen"/>
<link rel="stylesheet" href="css/ca2.css?v=<?php echo time();?>" type="text/css" media="screen"/>
<link rel="stylesheet" href="css/email.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="css/flipbook.css" media="screen" />
<link rel="stylesheet" href="scripts/galleria/themes/classic/galleria.classic.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="scripts/datatables/jquery.dataTables.min.css" type="text/css" media="screen" />


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="scripts/jstree/jstree.js"></script>
<script src="scripts/jquery.cookie.js"></script>
<script src="scripts/history/scripts/bundled/html4+html5/jquery.history.js"></script>
<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js"></script>
<script src="scripts/turnjs4/lib/turn.min.js"></script>
<script src="scripts/galleria/galleria-1.3.5.min.js"></script>
<script src="scripts/datatables/jquery.dataTables.min.js"></script>
<link rel="Shortcut Icon" type="image/png" href="image/churchicon.png" />

</head>

<body>
<div id="BannerContainer">
  <div id="Banner">
    <input id="ChurchesMenu" type="checkbox" name="churchesmenu" class="HiddenCheckbox"/>
    <label for="ChurchesMenu" id="ChurchesIcon" class="MenuIcon"></label>
    <div class="ChurchMenuContainer">
      <div class="ChurchMenuWrapper">
        <nav id="jstree_churches">
        </nav>
      </div>
    </div>
    <span class='BannerSpan'>Roughwood Places of Worship</span>
    <input id="OptionsMenu" type="checkbox" name="optionsmenu" class="HiddenCheckbox"/>
    <label for="OptionsMenu" id="OptionsIcon" class="MenuIcon"></label>


    <div class="OptionsMenuContainer">
      <ul class="OptionsMenuList">
      <legend class="OptionCategory">Search</legend>
       <ul id="WhatToSearch">
        <li>
          <label for="SearchAddress">
            <input type="radio" id="SearchAddress" name="SearchOpts" class="searchOptControl" value="A"/>
            <span>Search Place of Worship Address</span>
          </label>
        </li>
        <li>
          <label for="SearchName">
            <input type="radio" id="SearchName" name="SearchOpts" class="searchOptControl" value="N" checked/>
            <span>Search Place of Worship Name</span>
          </label>
        </li>
        <li>
          <label for="SearchParish">
            <input type="radio" id="SearchParish" name="SearchOpts" class="searchOptControl" value="P"/>
            <span>Search Parish Name</span>
          </label>
        </li>
        <li>
          <label for="SearchImageHeading">
            <input type="radio" id="SearchImageHeading" name="SearchOpts" class="searchOptControl" value="H"/>
            <span>Search Image Heading</span>
          </label>
        </li>
        <li>
          <label for="SearchImageText">
            <input type="radio" id="SearchImageText" name="SearchOpts" class="searchOptControl" value="T"/>
            <span>Search Image Text</span>
          </label>
        </li>
        <li>
          <label for="SearchText">
            <input type="search" id="SearchText" class="dispOptControl" placeholder="Min 3 chars, * for wildcard"/>
            <input type="submit" id="SearchSubmit" value="Search" disabled>
          </label>
        </li>
      </ul>

      <legend class="OptionCategory">Menu content options</legend>
      <ul id="WhatToShow">
        <li>
          <label for="IncludePhotos">
            <input type="checkbox" id="IncludePhotos" class="dispOptCheck" checked="true"/>
            <span>Include Roughwood photos</span>
          </label>
        </li>
        <li>
          <label for="IncludePostcards">
            <input type="checkbox" id="IncludePostcards" class="dispOptCheck" checked="true"/>
            <span>Include postcard images</span>
          </label>
        </li>
        <li>
          <label for="IncludeNoImage">
            <input type="checkbox" id="IncludeNoImage" class="dispOptCheck" checked="true"/>
            <span>Include churches without any images</span>
            </label>
        </li>
        <li>
          <label for="IncludeCounter">
            <input type="checkbox" id="IncludeCounter" class="dispOptCheck"/>
            <span>Show image counts</span>
            </label>
        </li>       
		<li>
          <label for="ModernBelow">
            <input type="checkbox" id="ModernBelow" class="dispOptCheck"/>
            <span>Show Modern parishes below ancient</span>
            </label>
        </li>


      </ul>
      <legend class="OptionCategory">Church display options</legend>
      <ul id="HowToShow">
        <li>
          <label for="AlbumPage">
            <input type="radio" id="AlbumPage" name="DispOpts" class="dispOptControl" value="A" checked/>
            <span>Album Page</span>
          </label>
        </li>
        <li>
          <label for="Thumbs">
            <input type="radio" id="Thumbs" name="DispOpts" class="dispOptControl" value="T"/>
            <span>Thumbnails</span>
          </label>
        </li>
        <li>
          <label for="ThumbCapts">
            <input type="radio" id="ThumbCapts" name="DispOpts" class="dispOptControl" value="C"/>
            <span>Thumbnails with captions</span>
          </label>
        </li>
        <li>
          <label for="ThumbList">
            <input type="radio" id="ThumbList" name="DispOpts" class="dispOptControl" value="L" hidden/>
            <span hidden>Thumbnails in a list</span>
          </label>
        </li>
        <li>
          <label for="Gallery">
            <input type="radio" id="Gallery" name="DispOpts" class="dispOptControl" value="G" hidden/>
            <span hidden>Gallery</span>
          </label>
        </li>
        <li>
          <label for="Book">
            <input type="radio" id="Book" name="DispOpts" class="dispOptControl" value="B" hidden/>
            <span hidden>Book</span>
          </label>
        </li>
        <li>
          <label for="IncludeSummary">
            <input type="checkbox" id="IncludeSummary" class="dispOptControl" checked="true"/>
            <span>Show church summary information</span>
          </label>
        </li>
      </ul>
    </div>
  </div>
</div>                                                        <!-- BannerContainer -->

<div id="ContentContainer" class="allcontent scrollbar-dynamic">
    <div id="churchdetails">
      <div id="churchheader">
      </div>
      <div id="churchcontent">                                <!-- thumbs, thumbs with captions, album page, list -->
      </div> <!-- churchcontent -->
      <div id="galleria" style="display: none">               <!-- gallery -->
      </div> <!-- galleria -->
      <div id="flipbookcontainer" style="display: none">      <!-- book -->
        <div id="flipbook">
          <div class="hard"> Churches </div>
          <div class="hard"></div>
          <div id="intro"></div>
          <div id="introback"></div>
          <div> Page 1 </div>
          <div> Page 2 </div>
          <div> Page 3 </div>
          <div> Page 4 </div>
          <div class="hard"></div>
          <div class="hard"></div>
        </div> <!-- flipbook -->
      </div> <!-- flipbookcontainer -->
      <div id='pagecontrols' style="display: none">          <!-- placeholder for pagination controls if needed -->
      </div>                                                 <!-- pagecontrols -->
    </div>                                                   <!-- churchdetails -->
</div>                                                       <!-- ContentContainer -->

<div id="FooterContainer">
  <div id="Footer">
  <span class="FooterSpan">Keep visiting - places of worship added regularly!</span></span>
  

  </div>  <!-- Footer -->
</div>  <!-- FooterContainer -->

<div id="lightbox" style="display: none">
  <div id="lightboxcontent">
	  <span class="lightboxhelper"></span>
    <img id="lightboximg" src="" />' +
  </div>
</div>
<script>

jQuery.extend({

/**
* Returns get parameters.
*
* If the desired param does not exist, null will be returned
*
* @example value = $.getURLParam("paramName");
*/

 getURLParam: function(strParamName)
 {
   var strReturn = "";
   var strHref = window.location.href;
   var bFound=false;
   var cmpstring = strParamName + "=";
   var cmplen = cmpstring.length;

   if (strHref.indexOf("?") > -1 )
   {
     var strQueryString = strHref.substr(strHref.indexOf("?")+1);
     var aQueryString = strQueryString.split("&");

     for ( var iParam = 0; iParam < aQueryString.length; iParam++ )
     {
       if (aQueryString[iParam].substr(0,cmplen) == cmpstring)
       {
         var aParam = aQueryString[iParam].split("=");
         strReturn = aParam[1];
         bFound = true;
         break;
       }
     }
   }
   if (bFound == false) return null;
   return strReturn;
 }
 });                                                                            // end of jquery extend

function configureBasedOnURLParams()                                            /* configure the app based on URL params - these overide the cookies */
{
  param = 'dm';
  value = $.getURLParam(param);
  if (value)
  {
    $("input[name=DispOpts][value="+value+"]").attr('checked', true);
    console.log("configureBaseOnURLParams, DispOpts value = " + value);
  }
  param = 'ic';  // include postcards
  value = $.getURLParam(param);
  if (value)
  {
    $("input[id=IncludePostcards]").attr('checked', true);
  }
  param ='ip';   // include photos
  value = $.getURLParam(param);
  if (value)
  {
    $("input[id=IncludePhotos]").attr('checked', true);
  }
}

function addParamsToURL(url, param, value)
{
  if ((value != null) && (value != ''))
  {
    if (url.indexOf("?") == -1)
    {
      url += "?";
    }
    else
    {
      url += "&";
    }
    url += param + "=" + value;
  }
  return url;
}


$('#OptionsMenu').click(function()
{
  if ($('#ChurchesMenu').is(':checked'))
  {
    $('#ChurchesMenu').click();                                                 /* Close churches menu if open */
  }
});


$('#ChurchesMenu').click(function()
{
  if ($('#OptionsMenu').is(':checked'))
  {
    $('#OptionsMenu').click();                                                  /* if options open, close it */
  }
});



$(function ()
  {
  // Check if there are any options set in the url, if there are update the controls
  // and the cookies
  
  configureBasedOnURLParams();
  
  param = 'c';
  church = $.getURLParam(param);
  if (church)                                                                   // church takes precedence over info
  {
    getChurchDetails(church, "churchphotogetter.php?" + param + "=" + church, 1, param);    // update church area if church is in url
  }
  else
  {
    param = 'cn';                                                               // find out if this is a country summary page
    country = $.getURLParam(param);
    if (country)
	{
	  getChurchDetails(church, "getcountrysummary.php?" + param + "=" + country, 1, param);    // update church area if country is in url
	}
    else
    {
      param = 'i';
      info = $.getURLParam(param);
      if (!info)
      {
        info = 'albuminfo';
      }
      else
	  {
	    switch (info)
	    {
	      case 'INFO':
		  case 'RCA':
		    info = 'albuminfo';
		    break
	    }
   	  }
      getChurchDetails(info, info + '.php', 1, param);
	}
  }
  initialisingTree = true;

  $('#jstree_churches').jstree(
  {
    'plugins' : ["themes", "html_data", "types", "wholerow", "json_data", "ui", "state"],
    'core' :
    {
      'themes' :
      {
        'name' : 'default'
      },
      'data' :
      {
        'url' : "getTheChurchesJSON.php",
        'type' : 'GET',
        'dataType' : 'JSON',
        'contentType' : 'application/json',
        'data' : function (node)
        {
          //console.log('Node: ' + node.id);
          if (node.id === "#")
          {
            //console.log('Loading Root Node ' + 'Table RCA');
            return {'id' : 'root', 'parent' : 'root', 't' : 'RCA', 'c': church};
          }
          else
          {
            //console.log('Loading node ' + node.id + '; parent ' + node.parent + '; table ' + node.original.t);
            return { 'id' : node.id, 'parent' : node.parent, 't' : node.original.t};
          }
        }
      }
    }
  })
  .bind("select_node.jstree", function(e, data)
  {
    if (initialisingTree == true)                                               // stop node select when refreshing
    {
      initialisingTree = false;
      return;
    }
    if (url = data.node.original.url)
    {
      console.log("Handler url is defined: " + url);
      //console.log("Node id: " + data.node.id);
      $('#ChurchesMenu').click();                                               /* close churches menu */
      $('html.body').scrollTop(0);
      itemId = data.node.id.replace(/\D/g,'');  // remove all letters from the id
      countyName = data.instance.get_node(data.instance.get_node(data.node.parent).parent).text;
      //console.log ("County: " + countyName);

      if (itemId == '')                 // when there is no numerical id it is an info item
      {
        value = data.node.id;
        param = 'i';
      }
      else
      {
        value = itemId;
        param = data.node.id.replace(/[^a-z]/g,'');  // get only lower case letters
      }
      console.log("value: " + value + " param: " + param);
	  switch (param)
	  {
	    case 'c':                                                // Church
          getChurchDetails(value, url, 1, param);
		  break;
		case 'cn':                                               // Country
		  getCountryDetails(value, url, 1);
		  break;
		case 'i':                                                // Information
		  loadInformationPage(value, url, 1);
		  break;
	  }
    }
    else
    {
      console.log("Handler url is NOT defined");
      //console.log("Node id: ");
    }
  });
  });
  
  function loadInformationPage(paramValue, url, updateState)
  {     
    console.log("Loading info page");
    $('#churchheader').hide();
    $('#churchcontent').data('i', paramValue);                                // save the parameter for use when the page comes back
    $('#churchcontent').load(url, function()
    {
      info = $('#churchcontent').data('i');
      if (updateState)
      {
        var state = {state : 0, html : $('#ContentContainer').html()};
          //console.log('updateState, URL: ' + url)
          //console.log('Pushing state for home page:' + JSON.stringify(state));
        History.pushState(state, "", "?i=" + info);
      }
      if (info == 'email')
      {
        contactFormLoaded();
      }
    });
  }

  function getCountryDetails(paramValue, url, updateState)
  
  {
    console.log("Loading country summary page");
    $('#churchheader').hide();
    $('#churchcontent').data('cn', paramValue);                                 // save the parameter for use when the page comes back
    $('#churchcontent').load(url, function(response, status)
    {
      if (status == "success")
      {
        console.log("Country details have loaded");
        countryId = $('#churchcontent').data('cn');
        console.log("countryId is: " + countryId);
		if (updateState)
        {
          var state = {state : countryId, html : $('#ContentContainer').html()};
                    //console.log('Pushing state, churchId: ' + churchId);
          History.pushState(state, "", "?cn=" + countryId);
        }
		
      }
      else
      {
        console.log("Country details failed to load");
      }
    });
  }
	
  function getChurchDetails(paramValue, url, updateState)
  {
    // console.log("getChurchDetails Value: " + paramValue + " Param: " + param);

    contentsDiv = "#churchcontent";
    $(contentsDiv).empty();

    dispOpt = $("input[name='DispOpts']:checked").val();                        // Get value of display options radio group

    switch (dispOpt)               // Prepare the divs for content
    {
      case 'G':
        //$(contentsDiv).html($('#galleria').html);                             // Gallery
        break;
      case 'B':
        //$(contentsDiv).html($('#flipbookcontainer').html);                    // Flip page book
        break;
    }

    url = addParamsToURL(url, "dm", dispOpt);                                   // dm is the parameter name, P_ListMode in PHP libraries

    switch (dispOpt)                                                            // Prepare the divs for content   may
    {
      case 'G':
          //$(contentsDiv).html($('#galleria').html);                           // Gallery
        break;
      case 'B':
          //$(contentsDiv).html($('#flipbookcontainer').html);                  // Flip page book
        break;
    }

    $('#churchcontent').data('church', paramValue);                             // store the churchID for future use

    $("#churchcontent").load(url, function(response, status)
    {
      if (status == "success")
      {
        console.log("Church details have loaded");
        churchId = $('#churchcontent').data('church');
        console.log("Church id is: " + churchId);

        if (churchId > 0)
        {
          $('#churchheader').load('churchsummarygetter.php?c='+churchId, function(response, status)
          {
            if (status == "success")
            {
              if (!$("#IncludeSummary").is(':checked'))
              {
                console.log("Hiding summary");
                $("#churchSummary").hide();
              }
              $('#churchheader').show();
              if (updateState)
              {
                var state = {state : churchId, html : $('#ContentContainer').html()};
                    //console.log('Pushing state, churchId: ' + churchId);
                History.pushState(state, "", "?c=" + churchId);
              }
            }
            else
            {
              console.log('Church header failed to load');
            }
         });
        }
      }
      else
      {
        console.log("Church details failed to load");
      }
    });
  }

function refreshChurchesMenu()                                                  // What to include options have changed so need to refresh
{
  $("#jstree_churches").jstree("refresh");
}

function updateChurchesMenu(churchId)                                           // When user selects a search result
{                                                                               // Select the correct menu option to match
  $.getJSON("getchurchhierarchy.php?c=" + churchId).done(function(json)
  {
    console.log( "updateChurchesMenu data loaded: " + JSON.stringify(json));
    $("#jstree_churches").jstree('open_node', 'cn_' + json.cn, function(e, data)
    {
      //console.log('Opening county: ' + json.cy);
      $("#jstree_churches").jstree('open_node', 'cy_' + json.cy, function(e, data)
      {
        //console.log('Opening parish: ' + json.p);
        $("#jstree_churches").jstree('open_node', 'p_' + json.p, function(e, data)
        {
          //console.log('Opening church: ' + json.c);
          $("#jstree_churches").jstree('open_node', 'c_' + json.c, function(e, data)
          {
            //console.log('Church ' + json.c+ ' has opened');
            // if the node is already selected, we need to deselect it to force the event handler to fire
            selectedNode = $("jstree_churches").jstree('get_selected').attr('id');
            if (selectedNode = ('c_' + json.c))
            {
              $("#jstree_churches").jstree('deselect_node', 'c_' + json.c, true);
            }
            $("#jstree_churches").jstree('select_node', 'c_' + json.c, true);
            
            $('#ChurchesMenu').click();        // Hide it because selecting a node makes it show
          }, false);
        }, false);
      }, false);
    }, false);
  });
}

History.Adapter.bind(window, 'statechange', function()
{
  var currentState = window.History.getState();
  //console.log("State changed: state (churchId): " + currentState.data.state);
  //console.log("Current state: " + JSON.stringify(currentState));
  $('#ContentContainer').html(currentState.data.html);
  $('#churchcontent').data('church', currentState.data.state);

});

// Functions for display options menu

      function updateWhatCookie()
      {
        var elementValues = {};
        $("#WhatToShow :checkbox").each(function()
        {
          elementValues[this.id] = this.checked;
        });
        //console.log("Updating WHAT cookie ", elementValues);
        $.cookie('WhatToShow', elementValues, { expires: 7, path: '/' });
        //if the cookie is updated, need to reset the menu
        initialisingTree = true;
        refreshChurchesMenu();                                                  // update menu to ensure it matches what to display
      }

      function updateHowCookie()
      {
        var elementValues = {};
        $("#HowToShow :radio").each(function()
        {
          elementValues[this.id] = this.checked;
        });
        $("#HowToShow :checkbox").each(function()
        {
          elementValues[this.id] = this.checked;
        });
        //console.log("Updating HOW cookie ", elementValues);
        $.cookie('HowToShow', elementValues, { expires: 7, path: '/' });
      };

      function repopulateDisplayOptionsMenu()
      {
        var elementValues = $.cookie('WhatToShow');
        if (elementValues)
        {
          Object.keys(elementValues).forEach(function(element)
          {
            var checked = elementValues[element];
            $("#" + element).prop('checked', checked);
          });
        }
        else                                                                    // cookie hasn't been set, so set it with defaults
        {
          updateWhatCookie();
        }
        elementValues = $.cookie('HowToShow');                                  // Now the How to show checkboxes
        if (elementValues)
        {
          Object.keys(elementValues).forEach(function(element)
          {
            var checked = elementValues[element];
            $("#" + element).prop('checked', checked);
          });
        }
        else                                                                    // cookie hasn't been set, so set it with defaults
        {
          updateHowCookie();
        }
      }

      $("#WhatToShow .dispOptCheck").on("change", function()
      {
        console.log("What to show options changed");
        updateWhatCookie();
      });

     $("input[name='DispOpts']").on("change", function ()
     {
        console.log("Display option changed");
        
        selectedNodeId = $('#jstree_churches').jstree().get_selected()[0];      // get selected node id
        //console.log("Selected Node Id: ", selectedNodeId);
        if (selectedNodeId != undefined)
        {
          $('a', '#'+selectedNodeId).click();                                     // Simulate click on menu
          $('#ChurchesMenu').click();        // Hide it because clicking on a menu item makes it show
        }
        updateHowCookie();
     });

// Handlers for display options

      $("#IncludeSummary").click(function()               // Handler for summary include option
      {
        if ($("#IncludeSummary").is(':checked'))
        {
          //console.log("Showing summary");
          $("#churchSummary").show(400);
        }
        else
        {
          //console.log("Hiding summary");
          $("#churchSummary").hide(400);
        }
        console.log("Include summary option clicked");
        updateHowCookie();
      });
      
// Handler for search text entry

      $("#SearchText").keyup(function()
      {
        if ($(this).val().length >= 3)
        {
          $("#SearchSubmit").prop('disabled', false);
        }
        else
        {
           $("#SearchSubmit").prop('disabled', true);
        }
      });
      
// Handler for search text enter key
   $("#SearchText").keyup(function(e)
   {
     var code = e.keyCode ? e.keyCode : e.which;
     if (code == 13)
     {
       $("#SearchSubmit").click();
     }
   });
      
// Handler for search submit button

    $("#SearchSubmit").click(function()
    {
      $('#OptionsMenu').click();              // Close the options menu
      console.log("Search initiated");
      searchOpt = $("input[name='SearchOpts']:checked").val();                  // What to search
      searchTxt = $("#SearchText").val();                                       // Search text
      url = "searchPOW.php?so=" + searchOpt + "&ss=" + searchTxt;
      header = "<h2>POWPICS Search submitted</h2>";
      switch (searchOpt)
      {
        case 'A':                   // Address
          searchobj = "place of worship address";
          break;
        case 'N':                   // Church Name
          searchobj = "place of worship name";
          break;
        case 'P':                   // Parish Name
          searchobj = "parish name";
          break;
        case 'H':                   // Image heading
          searchobj = "image heading";
          break;
        case 'T':                   // Image text
          searchobj = "image text";
          break;
      };
      message = "<h3 id=message>Searching " + searchobj + " for '" + searchTxt + "'</h3>";
      $('#churchheader').data("searchobj", searchobj);                          // Save these for the handler to use
      $('#churchheader').data("searchtxt", searchTxt);
      $('#churchheader').html(header + message);
      $('#churchheader').show();
      $('#churchcontent').empty();
      $('#churchcontent').show();
      
                        // change the next bit to ready the div, then load the data table
                        // using "ajaxSource": url    ?????  then set the headings to the returned JSON
                        // and append the data from the JSON?
                        // once working, change the church ajax to return JSON instead of HTML
      
      $('#churchcontent').load(url, function()
      {
          header = "<h2>POWPICS Search results</h2>";
          message = "<h3 id=message>Searched " + $('#churchheader').data("searchobj")
                                    + " for '" + $('#churchheader').data("searchtxt") + "'</h3>";
          $('#churchheader').html(header + message);
          


          table = $('#church_list').DataTable(                                  // https://datatables.net/ NOTE: This can take JSON data
          {
             "columnDefs": [{ "visible": false, "targets": 0 }],                // Hide the Id
            "sPaginationType": "full_numbers",
            "fnRowCallback": function(row, data, index)
            {
              $(row).click(function()                                           // Bind click event
              {
                   // get the church id from the table object
                var table = $('#churchcontent').data('table');
                var data = table.row(this).data();
                console.log(JSON.stringify(data));
                church = data[0];                                               // first column (hidden) contains the church id
                updateChurchesMenu(church);

               });
              return row;
           }
          });
          $('#churchcontent').data('table', table);  // save the table object reference in the div
          window.scrollTo({ top: 0, behavior: 'smooth' });
          // may want to add some code to enable the search results to be stored in history manager.  Or not.
          // http://yui.github.io/yui2/docs/yui_2.9.0_full/examples/datatable/dt_bhm_log.html

          $('#churchheader').removeData("searchtxt");
          $('#churchheader').removeData("searchopt");
      });
    });

// Handler to zoom images on click

      $(document).on("click", '.albumImage', function(event)
      {
        event.preventDefault();
        src = $(this).attr('src');
        //console.log("Source: " + src);
        big = $(this).data('big');
        //console.log("Big version" + big);
        if (big)
        {
          src = big;
        }

        // set the size of the lightbox here (to accomodate header/footer)

        if ($('#lightbox').length > 0)                                           // #lightbox exists
        {
          $('#lightboxcontent').html('<span class="lightboxhelper"></span><img id="lightboximg" src="' + src + '" />');               //insert img tag with clicked link's href as src value
          var maxheightvalue = $("#lightbox").height() - 150;
          var maxwidthvalue = $("#lightbox").width() - 60;
          $("#lightbox img").css("max-height", maxheightvalue + "px");
          $("#lightbox img").css("max-width", maxwidthvalue + "px");
          $('#lightbox').fadeIn(300) ;
        }
     });

     $('body').on('click', '#lightbox', function()
     {
       $('#lightbox').fadeOut(300);
     });

     // Ideally stop scroll bars from working when the lightbox is visible
     // seems to be difficult as preventDefault doesn't work

     // Esc handler to close lightbox
     $(document).keydown(function(e)
     {
       if (e.keyCode == 27) // ESCAPE key pressed
       {
         $('#lightbox').fadeOut(300);
       }
     });

     $("#flipbook").turn(
     {
       acceleration: true,
       gradients: true,
       turnCorners: "tl, tr",
       autoCenter: true
     });


 function contactFormLoaded()
 {
   console.log("Contact form loaded");

   $("#contactform").validate(
   {
     rules:
     {
       name:
       {
         required: true,
         minlength : 2
       },
       email:
       {
         required: true,
         email: true
       },
       message:
       {
         required: true,
         minlength: 50
       }
     },
     messages:
     {
       name:
       {
         required: "Please enter your name",
         minlength: "Name must have at least 2 characters"
       },
       email:
       {
         required: "Please enter your email address",
         email: "Email address not valid"
       },
       message:
       {
         required: "Please enter your message",
         minlength: "Your message is a bit short, please enter at least 50 characters"
       }
     },
     submitHandler:
     function(form)
     {
       //console.log('Contact form submitted');
       $('form input[type=submit]').prop("value", "Email being sent, please wait");
       $('form input[type=submit]').attr('disabled', 'disabled');               // Prevent multiple sends
       $.ajax(
       {
         data: $(form).serialize(),   // form data
         type: form.method,  // GET OR POST
         url: form.action,
         success: function(response)  // on success
         {
           //console.log('Form response received');
           $('#churchcontent').html(response);
           contactFormLoaded();
         }
       }
       );
    }
  });
};

$.cookie.json = true;                                                           // tell cookie library we're using JSON
repopulateDisplayOptionsMenu();                                                 // recover cookies and show in display options to match
</script>
</body>
</html>
