<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>MPLS Inter AS Option B - wiki.kemot-net.com</title>
    
    	<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
    // DEFINE DFP SLOTS
googletag.defineSlot('/1030917/wikidot_free_sites_top_728x90', [728, 90], 'div-gpt-ad-1410946564449-1').addService(googletag.pubads());
googletag.defineSlot('/1030917/wikidot_free_sites_bottom_300x250', [300, 250], 'div-gpt-ad-1410946564449-0').addService(googletag.pubads());

// googletag.pubads().enableSingleRequest();
googletag.pubads().collapseEmptyDivs(true, true);
googletag.pubads().setTargeting("w_name", "kemot-net");
googletag.pubads().setTargeting("w_domain", "com.kemot-net.wiki");
googletag.pubads().setTargeting("w_verified", "false");
if(null){googletag.pubads().setTargeting("w_cats", null);}
if(false){googletag.pubads().setTargeting("w_mn", "true");}
googletag.enableServices();
});
</script>
<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=494772"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "kemot-net.wikidot.com";
        WIKIREQUEST.info.siteId = 494772;
        WIKIREQUEST.info.siteUnixName = "kemot-net";
        WIKIREQUEST.info.categoryId = 3019353;
        WIKIREQUEST.info.themeId = 56;
        WIKIREQUEST.info.requestPageName = "mpls-inter-as-option-b";
        OZONE.request.timestamp = 1747344450;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "mpls-inter-as-option-b";
        WIKIREQUEST.info.pageId = 21779440;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
@import url(http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--modules/css/pagerate/PageRateWidgetModule.css);


        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--theme/base/css/style.css);
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--theme/co/css/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-41738827-1']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;MPLS Inter AS Option B&quot;" href="/feed/page/comments-21779440.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--4b961b7cc327/common--modules/js/pagerate/PageRateWidgetModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>wiki.kemot-net.com</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/main">Main</a>
<ul>
<li><a href="/switching">switching</a></li>
<li><a href="/edge-technologies">edge-technologies</a></li>
<li><a href="/igp-routing">igp-routing</a></li>
<li><a href="/bgp-routing">bgp-routing</a></li>
<li><a href="/qos">qos</a></li>
<li><a href="/multicast">multicast</a></li>
<li><a href="/ipv6">ipv6</a></li>
<li><a href="/security">security</a></li>
<li><a class="newpage" href="/ip-services">ip-services</a></li>
<li><a href="/mpls">mpls</a></li>
<li><a class="newpage" href="/platform">platform</a></li>
<li><a href="/optical">optical</a></li>
</ul>
</li>
<li><a href="https://www.ciscolive365.com/connect/search.ww" target="_blank">Cisco365 Virtual</a>
<ul>
<li><a href="/cisco-live-presentations">Cisco-Live-Presentations</a></li>
</ul>
</li>
<li><a href="http://www.cisco.com/en/US/solutions/ns340/ns414/ns742/ns741/networking_solutions_products_genericcontent0900aecd80601e22.html" target="_blank">Cisco SRND</a></li>
<li>Forums
<ul>
<li><a href="http://ieoc.com/forums/73.aspx" target="_blank">INE SP General</a></li>
<li><a href="http://ieoc.com/forums/74.aspx" target="_blank">INE SP Technical</a></li>
<li><a href="http://forums.cisco.com/eforum/servlet/NetProf?page=main" target="_blank">Cisco NetPro</a></li>
<li><a href="http://ieoc.com/forums/default.aspx" target="_blank">INE Forum</a></li>
<li><a href="http://ieoc.com/forums/68.aspx" target="_blank">INE R&amp;S Technical</a></li>
<li><a href="http://ieoc.com/forums/86.aspx" target="_blank">INE Lab I vol 5.0</a></li>
<li><a href="http://ieoc.com/forums/285.aspx" target="_blank">INE Lab II vol 5.0</a></li>
<li><a href="http://ieoc.com/forums/79.aspx" target="_blank">INE Lab III vol 5.0</a></li>
</ul>
</li>
<li><a href="https://tools.cisco.com/CCIE/Schedule_Lab/CCIEOnline/CCIEOnline" target="_blank">Schedule Lab</a></li>
<li>*Private
<ul>
<li><a href="https://docs.google.com/spreadsheet/ccc?key=0Avd9OzY_iCLIdG5IRVJFcnR5WmhnYzVWbDducVRTV3c&amp;usp=sharing" target="_blank">*CCIE-SP Spreadsheet</a></li>
<li><a href="https://docs.google.com/forms/d/1iZjkpV1kngOAnXpq-vKb0LdH0naahdDRe-lLrptSNRo/viewform" target="_blank">*TimeSheet</a></li>
<li><a href="https://mail.google.com/mail/u/0/?shva=1#label/CCIE%2FGroupStudy+CCIE" target="_blank">*Group Study Gmail</a></li>
<li><a href="http://wiki.kemot-net.com/system:page-tags/tag/draft">Drafts</a></li>
</ul>
</li>
<li>Wiki Management
<ul>
<li><a href="/wiki-new-content">Wiki-New-Content</a></li>
<li><a href="/site-map">Site-Map</a></li>
<li><a href="/wiki-forum">Wiki-Forum</a></li>
</ul>
</li>
<li><a href="/advanced-search">Advanced Search</a></li>
<li><a href="/about">About</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        

<h3 ><span>Cisco Docs</span></h3>
<ul>
<li><a href="http://www.cisco.com/cisco/web/psa/default.html?mode=tech" target="_blank">Cisco DocCD Main</a></li>
<li><a href="http://www.cisco.com/c/en/us/support/ios-nx-os-software/ios-xr-software/products-installation-and-configuration-guides-list.html#anchor4" target="_blank">IOS-XR 5.2 - ASR9K</a></li>
<li><a href="http://www.cisco.com/c/en/us/support/ios-nx-os-software/ios-xe-3-13s/model.html#ConfigurationGuides" target="_blank">IOS-XR 3.13s - ASR1K</a></li>
<li><a href="http://www.cisco.com/c/en/us/support/ios-nx-os-software/ios-software-release-15-4-3-s/model.html#ConfigurationGuides" target="_blank">IOS 15.4(3)S - 7600</a></li>
</ul>
<h3 ><span>Topics</span></h3>
<ul>
<li><a href="/igp-routing">igp-routing</a></li>
<li><a href="/bgp-routing">bgp-routing</a></li>
<li><a href="/mpls">mpls</a></li>
<li><a href="/multicast">multicast</a></li>
<li><a href="/qos">qos</a></li>
<li><a href="/switching">switching</a></li>
<li><a href="/edge-technologies">edge-technologies</a></li>
<li><a href="/ipv6">ipv6</a></li>
<li><a href="/security">security</a></li>
<li><a class="newpage" href="/ip-services">ip-services</a></li>
<li><a href="/platforms">platforms</a></li>
<li><a href="/optical">optical</a></li>
<li><a href="/high-availability">high-availability</a></li>
<li><a href="/automation">automation</a></li>
<li><a href="/peering">peering</a></li>
</ul>
<h3 ><span>Blueprints/Hardware v3</span></h3>
<ul>
<li><a href="/ccie-sp-lab-blueprint">ccie-sp-lab-blueprint</a></li>
<li><a href="/ccie-sp-written-blueprint">ccie-sp-written-blueprint</a></li>
<li><a href="/ccie-sp-hardware">ccie-sp-hardware</a></li>
</ul>
<h3 ><span>Blueprint/Hardware v4</span></h3>
<ul>
<li><a href="/ccie-sp-lab-blueprint-v4">ccie-sp-lab-blueprint-v4</a></li>
<li><a href="/ccie-sp-written-blueprint-v4">ccie-sp-written-blueprint-v4</a></li>
<li><a href="/ccie-sp-hardware-v4">ccie-sp-hardware-v4</a></li>
</ul>
<h3 ><span>Other</span></h3>
<ul>
<li><a href="/followup-topics">followup-topics</a></li>
<li><a href="/practice-list">practice-list</a></li>
<li><a href="/ccie-sp-reading-list">ccie-sp-reading-list</a></li>
<li><a href="/priv:ine-bootcamp-notes">*INE Adv Tech Notes</a></li>
<li><a href="/cisco-live-presentations">Cisco-Live-Presentations</a></li>
<li><a href="http://wiki.kemot-net.com/forum/c-1090607/reading-list">Reading List</a></li>
</ul>

                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            MPLS Inter AS Option B
                        </div>
                    

                    
                        <div id="breadcrumbs">
                            <a href="/main">Welcome</a> &raquo; <a href="/mpls">MPLS</a> &raquo; <a href="/vpn-l3">VPN Layer 3</a> &raquo; MPLS Inter AS Option B
                        </div>
                    

                                    <!-- wikidot_top_728x90 -->
<div id="div-gpt-ad-1410946564449-1" style="display: none" class="wd-adunit wd-adunit-dfp wd-adunit-above_content">

<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1410946564449-1'); });
</script>
</div>

            
    


                    <div id="page-content">
                        

<div style="min-height:600px&quot;">
<div id="toc" class="floatright">
<div id="toc-action-bar"><a href="javascript:;" onclick="WIKIDOT.page.listeners.foldToc(event)">Fold</a><a style="display: none" href="javascript:;" onclick="WIKIDOT.page.listeners.unfoldToc(event)">Unfold</a></div>
<div class="title">Table of Contents</div>
<div id="toc-list">
<div style="margin-left: 1em;"><a href="#toc0">Introduction</a></div>
<div style="margin-left: 1em;"><a href="#toc1">MPLS Inter-AS Option B</a></div>
<div style="margin-left: 2em;"><a href="#toc2">Routing Between ASBRs</a></div>
<div style="margin-left: 2em;"><a href="#toc3">Label Distribution</a></div>
<div style="margin-left: 2em;"><a href="#toc4">Route Target</a></div>
<div style="margin-left: 2em;"><a href="#toc5">Configuration</a></div>
<div style="margin-left: 1em;"><a href="#toc6">Relevant IOS Commands</a></div>
<div style="margin-left: 2em;"><a href="#toc7">mpls bgp forwarding</a></div>
<div style="margin-left: 2em;"><a href="#toc8">no bgp default route-target filter</a></div>
<div style="margin-left: 1em;"><a href="#toc9">Relevant XR Commands</a></div>
<div style="margin-left: 2em;"><a href="#toc10">retain route-target all</a></div>
<div style="margin-left: 1em;"><a href="#toc11">Additional Resources</a></div>
<div style="margin-left: 1em;"><a href="#toc12">Comments</a></div>
</div>
</div>
<h1 id="toc0"><span>Introduction</span></h1>
<p>Inter AS Option B is accomplished using BGP VPNv4 session between ASBRs exchanging labels with eBGP.</p>
<h1 id="toc1"><span>MPLS Inter-AS Option B</span></h1>
<ul>
<li><strong>The VPNv4 session between ASBRs is used to exchange the VPNv4 prefixes. The BGP session is used to send the transport label</strong>.</li>
<li><strong>Route Distinguisher and Route Targets have global significance between adj providers.</strong></li>
<li>A labeled switched path has to exist between the PEs or each carrier. Exchange of labels is accomplished using BGP on the Inter-AS link..</li>
<li>There are three LSPs (points where next-hop changes):
<ul>
<li>PE to the ASBR1.</li>
<li>ASBR1 to ASBR2</li>
<li>ASBR2 to the PE</li>
</ul>
</li>
<li>LSP is end to end (using three hops), which makes QoS much easier to manage.</li>
<li>ASBRs have to have all of the VPN prefixes, which requires it to be as resource intensive as Rotuer Reflectors.</li>
<li><strong>By default, forwarding of labled traffic will not work between IOS and XR in option B</strong>. On IOS when <strong>mpls bgp forwarding</strong> command is entered, the router creates a /32 for the peering interface along with a /32 for the neighbor. XR can not label switch traffic to a next-hop that's not learned via a host route /32. XR by default does not do that. <strong>On XR to fix it, create a static /32 host route to the neighboring IP on the directly connected ASBR.</strong>. If the static points to interface and then next-hop. BGP will consider it as multi-hop, either configure it as multi-hop eBGP or just use interface like &quot;router static address-family w.x.y.z gi0/0/0/0.30&quot;</li>
</ul>
<h2 id="toc2"><span>Routing Between ASBRs</span></h2>
<ul>
<li>ASBRs only use eBGP with VPNv4 address family between each other. There is no need to have local vrfs like in Option A.</li>
<li>Service Providers don't need to worry about operting client's IGP protocols.</li>
<li><strong>mpls bgp forwarding</strong> command is automatically configured when setting VPNv4 eBGP session, it specifies that interfaces connected to the peer could forward labels over it and received labelled frames. Usually any interfaces not running mpls (i.e. LDP/RSVP) will drop all labels and try to forwarding using IP.</li>
<li>In XR remember that VPNv4 eBGP session still require <strong>route-policies</strong> as with any other eBGP session on XR.</li>
<li>Because this is an eBGP session, the next hop for VPNv4 prefixes will change. The internal PE routers usually won't have reachability to the ASBR link between carriers. <strong>Therefore the next-hop has to be changed to self.</strong></li>
</ul>
<div class="collapsible-block">
<div class="collapsible-block-folded"><a class="collapsible-block-link" href="javascript:;">+&nbsp;Show&nbsp;Sample&nbsp;Traceroute</a></div>
<div class="collapsible-block-unfolded" style="display:none">
<div class="collapsible-block-unfolded-link"><a class="collapsible-block-link" href="javascript:;">-&nbsp;Hide&nbsp;Sample&nbsp;Traceroute</a></div>
<div class="collapsible-block-content">
<ul>
<li>4th hop is the ASBR link. It uses a new transport different label 16005 switches it for a new label 16004 and transport label 17.</li>
<li>This traceroute shows that there are three LSP involved:
<ul>
<li>label 30</li>
<li>label 16005</li>
<li>label 16004</li>
</ul>
</li>
</ul>
<div class="code">
<pre>
<code>R7#TRACeroute 8.8.8.8 SOUrce LOOP0

Type escape sequence to abort.
Tracing the route to 8.8.8.8

  1 40.2.7.2 16 msec 12 msec 12 msec
  2 10.2.3.3 [MPLS: Labels 17/30 Exp 0] 48 msec 68 msec 64 msec
  3 10.1.3.1 [MPLS: Label 30 Exp 0] 84 msec 64 msec 88 msec
  4 30.1.19.19 [MPLS: Label 16005 Exp 0] 56 msec 52 msec 44 msec
  5 20.4.19.4 [MPLS: Labels 17/16004 Exp 0] 72 msec 76 msec 52 msec
  6 20.4.20.20 [MPLS: Label 16004 Exp 0] 48 msec 72 msec 80 msec
  7 40.8.20.8 96 msec *  76 msec</code>
</pre></div>
</div>
</div>
</div>
<h2 id="toc3"><span>Label Distribution</span></h2>
<ul>
<li>Labels are exchanged using BGP. Usual protocols like LDP or RSVP are not used to exchange labels.</li>
<li>Link towards ASBRs require <strong>mpls bgp forwarding</strong> enabled.</li>
<li><strong>The ASBRs will not only have a label for the PE loopbacks, but also for a label for the VPNv4 prefixes.</strong></li>
<li>ASBRs peer with each other using VPNv4 eBGP, the LSP is end-to-end, but LDP is not operating over that link. <strong>Labels are sent using BGP</strong>.</li>
<li>ASBRs will <strong>change the VPN Label and set it to themselves</strong>.</li>
<li>The ASBRs will have a label not only for any next-hop addresses, but also VPNv4 prefixes:</li>
</ul>
<div class="collapsible-block">
<div class="collapsible-block-folded"><a class="collapsible-block-link" href="javascript:;">+&nbsp;Show&nbsp;mpls&nbsp;forwarding</a></div>
<div class="collapsible-block-unfolded" style="display:none">
<div class="collapsible-block-unfolded-link"><a class="collapsible-block-link" href="javascript:;">-&nbsp;Hide&nbsp;mpls&nbsp;forwarding</a></div>
<div class="collapsible-block-content">
<ul>
<li>For example 200:1:10.10.10.10/32 which is VPNv4 prefix with RD 200:1.</li>
<li>Ensure that the ASBR next-hop link is also in the LFIB, if not check the static route and mpls forwarding.</li>
</ul>
<div class="code">
<pre>
<code>R1#sh mpls forwarding-table 
Local      Outgoing   Prefix           Bytes Label   Outgoing   Next Hop    
Label      Label      or Tunnel Id     Switched      interface              
16         16         2.2.2.2/32       0             Fa0/0.13   10.1.3.3    
17         Pop Label  3.3.3.3/32       0             Fa0/0.13   10.1.3.3    
18         Pop Label  10.2.3.0/24      0             Fa0/0.13   10.1.3.3    
19         23         100:2:7.7.7.7/32 3098          Fa0/0.13   10.1.3.3    
20         20         100:1:30.2.9.0/24   \
                                       0             Fa0/0.13   10.1.3.3    
22         19         100:1:9.9.9.9/32 3098          Fa0/0.13   10.1.3.3    
24         21         100:2:40.2.7.0/24   \
                                       0             Fa0/0.13   10.1.3.3    
25         Pop Label  30.1.19.19/32    0             Fa0/0.30   30.1.19.19  
28         16009      200:1:10.10.10.10/32   \
                                       1398          Fa0/0.30   30.1.19.19  
29         16010      200:1:30.10.20.0/24   \
                                       0             Fa0/0.30   30.1.19.19  
30         16005      200:2:8.8.8.8/32 1398          Fa0/0.30   30.1.19.19  
31         16003      200:2:40.8.20.0/24   \
                                       0             Fa0/0.30   30.1.19.19</code>
</pre></div>
</div>
</div>
</div>
<h2 id="toc4"><span>Route Target</span></h2>
<ul>
<li>Make sure to disable the RT filtering or else the ASBR won't accept any VPNv4 prefixes:
<ul>
<li>IOS: <strong>no bgp default route-target filter</strong></li>
<li>XR: <strong>address-family vpnv4 unicast</strong>
<ul>
<li><strong>retain route-target all</strong></li>
</ul>
</li>
</ul>
</li>
<li>RT Filtering feature is automatically disabled on VPNv4 Router Reflectors, but since those are ASBR PEs they will need have it disabled manually.</li>
<li>By default the Router Target numbering convention and policy has to be end-to-end and the same between service providers. That's a huge limitation for adaptation between carriers. <a class="newpage" href="/mpls-route-target-rewrite">Route Target rewrite</a> feature can be used on the ASBRs (more: <a href="http://www.cisco.com/en/US/docs/ios/12_0s/feature/guide/fsrtrw.html">http://www.cisco.com/en/US/docs/ios/12_0s/feature/guide/fsrtrw.html</a>)</li>
</ul>
<h2 id="toc5"><span>Configuration</span></h2>
<ul>
<li>Configure eBGP VPNv4 session between ASBRs.</li>
<li>Set the next-hop-self to iBGP VPNv4 sessions.</li>
<li>On IOS-XR create a static host route to the neighbor just using the interface (no next-hop ip address, will break MPLS forwarding if next-hop is included).</li>
<li>Configure ASBRs to accept all RT by turning off the rt filtering.</li>
<li>Configure route-map and/or RPLs to translate RTs.</li>
</ul>
<div class="collapsible-block">
<div class="collapsible-block-folded"><a class="collapsible-block-link" href="javascript:;">+&nbsp;Show&nbsp;XR&nbsp;Configuration</a></div>
<div class="collapsible-block-unfolded" style="display:none">
<div class="collapsible-block-unfolded-link"><a class="collapsible-block-link" href="javascript:;">-&nbsp;Hide&nbsp;XR&nbsp;Configuration</a></div>
<div class="collapsible-block-content">
<ul>
<li>BGP configuration sets up regular eBGP VPNv4.</li>
<li>Retains all route-targets instead of only locally imported.</li>
<li>RPL used to translate the RTs format from one AS to current.</li>
</ul>
<div class="code">
<pre>
<code>router bgp 200
 address-family vpnv4 unicast
  retain route-target all            &lt;---accept all RTs
 !
 neighbor 30.1.19.1
  remote-as 100
  address-family vpnv4 unicast
   route-policy RT-TRANSLATION in     &lt;---used to change RTs
   route-policy eBGP out
  !</code>
</pre></div>
<ul>
<li>Static host route for directly connected eBGP VPNv4 peer is required.</li>
<li>Make sure not to specify the next-hop, label forwarding won't work with it.</li>
</ul>
<div class="code">
<pre>
<code>router static
 address-family ipv4 unicast
  30.1.19.1/32 GigabitEthernet0/0/0/0.30   &lt;--- required for label forwarding
 !</code>
</pre></div>
<ul>
<li>Sample RPL used to translate from RT 100:1 to RT 200:1 &#8230;etc.</li>
</ul>
<div class="code">
<pre>
<code>route-policy RT-TRANSLATION
  if extcommunity rt matches-any (100:1) then
    set extcommunity rt (200:1)
  elseif extcommunity rt matches-any (100:2) then
    set extcommunity rt (200:2)
  end-policy</code>
</pre></div>
</div>
</div>
</div>
<div class="collapsible-block">
<div class="collapsible-block-folded"><a class="collapsible-block-link" href="javascript:;">+&nbsp;Show&nbsp;IOS&nbsp;Configuration</a></div>
<div class="collapsible-block-unfolded" style="display:none">
<div class="collapsible-block-unfolded-link"><a class="collapsible-block-link" href="javascript:;">-&nbsp;Hide&nbsp;IOS&nbsp;Configuration</a></div>
<div class="collapsible-block-content">
<ul>
<li>Interface has to have bgp forwarding or else labels will be stripped and data plane won't works.</li>
<li>IOS XR does this by default.</li>
</ul>
<div class="code">
<pre>
<code>interface FastEthernet0/0.30
 ip address 30.1.19.1 255.255.255.0
 mpls bgp forwarding                &lt;---- needs to be there
end</code>
</pre></div>
<ul>
<li>BGP configuration required to turn off locally imported filtering and allow all.</li>
<li>Route-map to translate RT from one AS to another.</li>
</ul>
<div class="code">
<pre>
<code>router bgp 100
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 no bgp default route-target filter          &lt;--- accept all RTs
 neighbor 30.1.19.19 remote-as 200
 !
 address-family vpnv4
  neighbor 30.1.19.19 activate
  neighbor 30.1.19.19 send-community both
  neighbor 30.1.19.19 route-map RT-TRANSLATION in  &lt;--use to change RTs
 exit-address-family</code>
</pre></div>
<ul>
<li>Sample route-map to translate RT communities from one AS to another.</li>
</ul>
<div class="code">
<pre>
<code>ip extcommunity-list standard VPN_A permit rt 200:1
ip extcommunity-list standard VPN_B permit rt 200:2

route-map RT-TRANSLATION permit 10
 match extcommunity VPN_A
 set extcommunity rt 100:1
route-map RT-TRANSLATION permit 20
 match extcommunity VPN_B
 set extcommunity rt 100:2</code>
</pre></div>
</div>
</div>
</div>
<h1 id="toc6"><span>Relevant IOS Commands</span></h1>
<h2 id="toc7"><span>mpls bgp forwarding</span></h2>
<div class="code">
<pre>
<code>R1(config-if)#        mpls bgp forwarding</code>
</pre></div>
<h2 id="toc8"><span>no bgp default route-target filter</span></h2>
<div class="code">
<pre>
<code>R1(config-router)#        no bgp default route-target filter</code>
</pre></div>
<h1 id="toc9"><span>Relevant XR Commands</span></h1>
<h2 id="toc10"><span>retain route-target all</span></h2>
<div class="code">
<pre>
<code>RP/0/0/CPU0:XR1(config-bgp-af)#  retain route-target all</code>
</pre></div>
<h1 id="toc11"><span>Additional Resources</span></h1>
<p><a href="http://mellowd.co.uk/ccie/?p=3783" target="_blank">Inter-AS MPLS L3VPN – Option B – ASBR + VPNv4</a> - Darren's Blog<br />
(Dual CCIE #38070 (R&amp;S, SP) and JNCIE-SP #2227)</p>
<h1 id="toc12"><span>Comments</span></h1>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" >
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
			</div>
	
	
	
</div>
<div style="text-align: right;"><div class="page-rate-widget-box"><span class="rate-points">rating:&nbsp;<span class="number prw54353">+2</span></span><span class="rateup btn btn-default"><a title="I like it" href="javascript:;" onclick="WIKIDOT.modules.PageRateWidgetModule.listeners.rate(event, 1)">+</a></span><span class="ratedown btn btn-default"><a title="I don't like it" href="javascript:;" onclick="WIKIDOT.modules.PageRateWidgetModule.listeners.rate(event, -1)">&#8211;</a></span><span class="cancel btn btn-default"><a title="Cancel my vote" href="javascript:;" onclick="WIKIDOT.modules.PageRateWidgetModule.listeners.cancelVote(event)">x</a></span></div></div>
</div>

                    </div>

                                    <!-- wikidot_bottom_300x250 -->
<div id="div-gpt-ad-1410946564449-0" style="display: none" class="wd-adunit wd-adunit-dfp wd-adunit-below_content">

<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1410946564449-0'); });
</script>
</div>

            
    

                                        
    

                    



                    
                        <div class="page-tags">
                            <span>
                                <a href="/system:page-tags/tag/inter-as-option-b#pages">inter-as-option-b</a><a href="/system:page-tags/tag/l3vpn#pages">l3vpn</a><a href="/system:page-tags/tag/mpls#pages">mpls</a><a href="/system:page-tags/tag/option-b#pages">option-b</a><a href="/system:page-tags/tag/vpn#pages">vpn</a>
                            </span>
                        </div>
                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>