<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8"/>
<title>CAN BUS Tutorial - Embedded Systems Learning Academy</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"CAN_BUS_Tutorial","wgTitle":"CAN BUS Tutorial","wgCurRevisionId":40048,"wgRevisionId":40048,"wgArticleId":667,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"CAN_BUS_Tutorial","wgRelevantArticleId":667,"wgRequestId":"ca8fdde75ec676247ed51d43","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":false,"dialogs":false,"preview":false,"publish":false}});mw.loader.implement("user.options",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup"]);});</script>
<link rel="stylesheet" href="/sjsu/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook"/>
<!--[if IE 6]><link rel="stylesheet" href="/sjsu/skins/MonoBook/IE60Fixes.css?303" media="screen"/><![endif]--><!--[if IE 7]><link rel="stylesheet" href="/sjsu/skins/MonoBook/IE70Fixes.css?303" media="screen"/><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content=""/>
<script async="" src="/sjsu/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.27.1"/>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="/sjsu/opensearch_desc.php" title="Embedded Systems Learning Academy (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://socialledge.com/sjsu/api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="Embedded Systems Learning Academy Atom feed" href="/sjsu/index.php?title=Special:RecentChanges&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-CAN_BUS_Tutorial rootpage-CAN_BUS_Tutorial skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">CAN BUS Tutorial</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Embedded Systems Learning Academy</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#CAN_BUS"><span class="tocnumber">1</span> <span class="toctext">CAN BUS</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#CAN_BUS_Frame"><span class="tocnumber">1.1</span> <span class="toctext">CAN BUS Frame</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Message_ID"><span class="tocnumber">1.2</span> <span class="toctext">Message ID</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Transceiver"><span class="tocnumber">1.3</span> <span class="toctext">Transceiver</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Multi-node_CAN_BUS"><span class="tocnumber">2</span> <span class="toctext">Multi-node CAN BUS</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Message_ID_Design"><span class="tocnumber">2.1</span> <span class="toctext">Message ID Design</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#OBDII"><span class="tocnumber">3</span> <span class="toctext">OBDII</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#CAN_on_LPC17xx"><span class="tocnumber">4</span> <span class="toctext">CAN on LPC17xx</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#LPC_FullCAN"><span class="tocnumber">4.1</span> <span class="toctext">LPC FullCAN</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Hardware_Filters"><span class="tocnumber">4.2</span> <span class="toctext">Hardware Filters</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#DBC"><span class="tocnumber">4.3</span> <span class="toctext">DBC</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Resources"><span class="tocnumber">5</span> <span class="toctext">Resources</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#External_Resources"><span class="tocnumber">5.1</span> <span class="toctext">External Resources</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="CAN_BUS">CAN BUS</span></h2>
<p><font color="red"> This article is under construction </font>
<br />
CAN BUS (Controller Area Network) is a very deterministic BUS heavily used in the automotive industry.  It is a half-duplex BUS, that operates using a pair of differential signals.  Typically, the speed standards are 100K, 250K, 500K or 1Mbit.
</p><p>CAN BUS may have several tens of controllers on the same BUS and you can typically go relatively long distances such as 10 meters without compromising the speed or reliability.  The message id of each message can address other nodes on a CAN BUS (more on this later).
</p>
<h3><span class="mw-headline" id="CAN_BUS_Frame">CAN BUS Frame</span></h3>
<p>A CAN frame may contain 50-114 bits which includes data bits like message id, the real payload (0-8 bytes), and some CRC bytes.  After the hardware captures the CAN frame, it stores it into a simpler frame that contains frame information, message id, and the data bytes.
</p><p>A CAN frame may contain one of two message id types&#160;:
</p>
<ul><li>  11-bit</li>
<li>  29-bit</li></ul>
<pre>   | Frame Information            | Message ID   | 0-8 bytes |
   | RTR, Msg ID Type, Byte Count | 11 or 29-bit | 0-8 bytes |
</pre>
<p><br />
</p>
<ul><li>  RTR&#160;: Remote transmission frame
<dl><dd>  This bit indicates to the destination that an empty message is being sent.</dd>
<dd>  You can consider this "PING" or a signal to send something back to the source</dd></dl></li>
<li>  Message ID Type
<dl><dd>  This bit (when 1) indicates it is a 29-bit ID or else an 11-bit ID</dd></dl></li>
<li>  Data bytes
<dl><dd>  The payload can be zero bytes, or up to full 8 bytes in a CAN frame.</dd></dl></li></ul>
<h3><span class="mw-headline" id="Message_ID">Message ID</span></h3>
<p>A message ID of a CAN frame is very unique in the sense that it is used as a priority on the physical BUS.  <b>A lower message ID has higher priority</b> since logical 0s are dominant and they override logical 1s on the BUS.  This is a key feature of the CAN BUS because you can guarantee that your message will get across above everyone else if it has the highest priority.
</p><p>Another property of the message id is that each node on a CAN bus MUST acknowledge a chosen message id for a message to be successful.  If a message is not acknowledged, retransmissions will take place by the hardware, which can eventually lead to "BUS-OFF" state as given by the CAN specifications.
</p>
<h3><span class="mw-headline" id="Transceiver">Transceiver</span></h3>
<p>Unlike other BUSes that can be up and running without any external hardware, CAN BUS <b>REQUIRES</b> a voltage transceiver that converts logical Rx/Tx pins into a single differential pair wire that is hooked up on the CAN BUS.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Multi-node_CAN_BUS">Multi-node CAN BUS</span></h2>
<p>Before the CAN BUS is used in an application, it helps to know some basic characteristics of the BUS&#160;:
</p>
<ul><li>  No two nodes shall send the same message ID
<dl><dd>  Doing so will cause two nodes to cause collisions on the BUS, since arbitration will not take place.</dd></dl></li>
<li>  No two nodes shall acknowledge the same message ID
<dl><dd>  Doing so will cause two nodes to acknowledge the same packet.</dd></dl></li></ul>
<p>So knowing the above requirements, there is a dilemma for us:
</p>
<ul><li>  How can two nodes send a message to another node using the same message id&#160;?</li></ul>
<h3><span class="mw-headline" id="Message_ID_Design">Message ID Design</span></h3>
<p>What we can do is split the message id into separate fields so each node on a CAN bus can address any other node:
</p>
<pre>   | 4-bit destination id | 4-bit source id | 3-bit message id |
</pre>
<p>What we have done now is added the capability that multiple nodes can speak to each other, and whoever has the lowest source id has the highest priority on the CAN BUS.  So suppose that we are a "lights controller" on a vehicle's CAN BUS, then we can specify the following standard&#160;:
</p>
<ul><li>  Lights Controller ID: 5</li>
<li>  Message ID&#160;: 1 = Lights command</li>
<li>  Message ID&#160;: 2 = Clear Faults</li></ul>
<p>With this in mind, we would tell our CAN controller to accept the following range of all message ids:
</p>
<pre>   | 0101 | xxxx | xxx |
</pre>
<p>Therefore, our CAN acceptance filter is 0x280 - 0x2FF.  If we do this, anyone can send us a message, and no two nodes will send the same message id.  Likewise, we can send a response message back to anyone using a unique message id.
</p><p><br />
</p>
<h2><span class="mw-headline" id="OBDII">OBDII</span></h2>
<p>OBDII standard uses CAN BUS to communicate to the ECU.  You can connect a CAN controller to an OBDII port easily by using an <a target="_blank" rel="nofollow noreferrer noopener" class="external text" href="https://www.sparkfun.com/products/10087">OBDII to Serial</a> cable.  Since this kind of cable doesn't convert the CAN voltage signals to logical signals that a microcontroller can understand, you would also need an MCP2561 based transceiver which would allow your controller to be interfaced to an OBDII port. 
</p><p>The block diagram would be as follows&#160;:
</p>
<pre>   | Car's computer --&gt; CAN BUS --&gt; (OBDII Port) --&gt; MCP2561 --&gt; Your CAN controller |
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="CAN_on_LPC17xx">CAN on LPC17xx</span></h2>
<p>LPC17xx or the <b>SJ-One Board</b> has two CAN controllers and the Sourceforge development package' projects contain the CAN driver.  Therefore, you can connect to two separate CAN BUSes, however, some of the internal hardware is shared between the two CAN controllers.  Note that a CAN controller needs to setup its filters such that it can generate ACKs and accept the chosen messages when another controller sends the specific CAN messages.  The LPC17xx CAN allows you to setup your CAN acceptance filters in one of several ways&#160;:
</p>
<ul><li>  FullCAN message reception</li>
<li>  Standard (11-bit) ID list</li>
<li>  Standard ID range (low to high)</li>
<li>  Extended (29-bit) ID list</li>
<li>  Extended ID range (low to high)</li></ul>
<p>Also note that the space for these filters are limited to 2Kb internal RAM, however, this is enough to setup 512 individual 29-bit addresses or 1024 standard message IDs.  Generally, if you exhaust this space, you are doing something wrong or your CAN BUS protocol is badly designed.
</p>
<h3><span class="mw-headline" id="LPC_FullCAN">LPC FullCAN</span></h3>
<p>Using FullCAN is one of the ways to setup a CAN message acceptance filter, and you have to know the exact id of each message.  The LPC FullCAN is a way for us to specify specific message IDs and these messages are stored straight to RAM without our software getting interrupted!  This is a neat away to automatically accept and store messages without using CPU cycles.  There exist a means to test if the HW has updated a specific message and you can even get interrupt notifications for up to first 64 FullCAN messages.  
</p>
<h3><span class="mw-headline" id="Hardware_Filters">Hardware Filters</span></h3>
<p>The hardware filters (apart from FullCAN) provide second means of accepting specific message ids.  Furthermore, you can also specify a range, for example, you can program it to accept all messages from standard 11-bit id range 0x100 to 0x200.  The CPU can or will get interrupted upon accepting a message, and then your software can queue or process the incoming message.  The hardware filter also provide a way to setup 29-bit message id acceptance filter.
</p><p><br />
</p>
<h3><span class="mw-headline" id="DBC">DBC</span></h3>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://www.socialledge.com/sjsu/index.php?title=DBC_Format">http://www.socialledge.com/sjsu/index.php?title=DBC_Format</a>
</p>
<h2><span class="mw-headline" id="Resources">Resources</span></h2>
<h3><span class="mw-headline" id="External_Resources">External Resources</span></h3>
<ul><li>  LPC2000 CAN BUS Appnote
<dl><dd> <a href="/sjsu/index.php/File:CAN_AN10674.pdf" title="File:CAN AN10674.pdf">File:CAN AN10674.pdf</a></dd></dl></li>
<li>  Keil CAN BUS Primer
<dl><dd> <a href="/sjsu/index.php/File:CAN_keil_primer_v2.pdf" title="File:CAN keil primer v2.pdf">File:CAN keil primer v2.pdf</a></dd></dl></li>
<li>  Microchip CAN BUS Appnote
<dl><dd> <a href="/sjsu/index.php/File:CAN_microchip_appnote.pdf" title="File:CAN microchip appnote.pdf">File:CAN microchip appnote.pdf</a></dd></dl></li>
<li>  TI CAN Bus tutorial
<dl><dd> <a target="_blank" rel="nofollow noreferrer noopener" class="external text" href="http://www.ti.com/lit/an/sloa101a/sloa101a.pdf">CAN Bus</a></dd></dl></li></ul>

<!-- 
NewPP limit report
Cached time: 20250515072328
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.004 seconds
Real time usage: 0.007 seconds
Preprocessor visited node count: 51/1000000
Preprocessor generated node count: 58/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key my_wiki:pcache:idhash:667-0!*!*!!en!5!* and timestamp 20250515072328 and revision id 40048
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://socialledge.com/sjsu/index.php?title=CAN_BUS_Tutorial&amp;oldid=40048">http://socialledge.com/sjsu/index.php?title=CAN_BUS_Tutorial&amp;oldid=40048</a>"</div>
					<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="/sjsu/index.php/CAN_BUS_Tutorial" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/sjsu/index.php?title=Talk:CAN_BUS_Tutorial&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="/sjsu/index.php?title=CAN_BUS_Tutorial&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="/sjsu/index.php?title=CAN_BUS_Tutorial&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-login"><a href="/sjsu/index.php?title=Special:UserLogin&amp;returnto=CAN+BUS+Tutorial" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="/sjsu/index.php/Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage-description"><a href="/sjsu/index.php/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
											<li id="n-recentchanges"><a href="/sjsu/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="/sjsu/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" target="_blank" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="/sjsu/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Embedded Systems Learning Academy [f]" accesskey="f" id="searchInput"/>
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton"/>&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"/>
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="/sjsu/index.php/Special:WhatLinksHere/CAN_BUS_Tutorial" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="/sjsu/index.php/Special:RecentChangesLinked/CAN_BUS_Tutorial" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="/sjsu/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="/sjsu/index.php?title=CAN_BUS_Tutorial&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="/sjsu/index.php?title=CAN_BUS_Tutorial&amp;oldid=40048" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="/sjsu/index.php?title=CAN_BUS_Tutorial&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
		<div class="generated-sidebar portlet" id="p-googleadsense" role="navigation">
		<h3>Google AdSense</h3>
		<div class='pBody'>
			<script type="text/javascript"><!--
google_ad_client = "ca-pub-2792492894831533";
/* socialledge_ws */
google_ad_slot = "6379987209";
google_ad_width = 160;
google_ad_height = 600;
// -->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>		</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<img src="/sjsu/resources/assets/licenses/public-domain.png" alt="Public Domain" width="88" height="31"/>
							</div>
					<div id="f-poweredbyico">
									<a href="//www.mediawiki.org/"><img src="/sjsu/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/sjsu/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /sjsu/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 12 October 2017, at 23:13.</li>
									<li id="copyright">Content is available under Public Domain unless otherwise noted.</li>
									<li id="privacy"><a href="/sjsu/index.php/Embedded_Systems_Learning_Academy:Privacy_policy" title="Embedded Systems Learning Academy:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="/sjsu/index.php/Embedded_Systems_Learning_Academy:About" title="Embedded Systems Learning Academy:About">About Embedded Systems Learning Academy</a></li>
									<li id="disclaimer"><a href="/sjsu/index.php/Embedded_Systems_Learning_Academy:General_disclaimer" title="Embedded Systems Learning Academy:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);});</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-35170676-1");
pageTracker._trackPageview();
</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":26});});</script></body></html>
