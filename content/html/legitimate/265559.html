 <!DOCTYPE html>
		<html
			class="layout layout-holy-grail   show-table-of-contents conceptual show-breadcrumb default-focus"
			lang="en-us"
			dir="ltr"
			data-authenticated="false"
			data-auth-status-determined="false"
			data-target="docs"
			x-ms-format-detection="none"
		>
			
		<head>
			<title>Faster Code with the Modern Language Features of Visual C++ 2005 | Microsoft Learn</title>
			<meta charset="utf-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0" />
			<meta name="color-scheme" content="light dark" />

			
			<link rel="canonical" href="https://learn.microsoft.com/en-us/archive/msdn-magazine/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005" /> 

			<!-- Non-customizable open graph and sharing-related metadata -->
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:site" content="@MicrosoftLearn" />
			<meta property="og:type" content="website" />
			<meta property="og:image:alt" content="Microsoft Learn" />
			<meta property="og:image" content="https://learn.microsoft.com/en-us/media/open-graph-image.png" />
			<!-- Page specific open graph and sharing-related metadata -->
			<meta property="og:title" content="Faster Code with the Modern Language Features of Visual C++ 2005" />
			<meta property="og:url" content="https://learn.microsoft.com/en-us/archive/msdn-magazine/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005" />
			
			<meta name="platform_id" content="0ab133b3-511f-19ca-c958-3fae83d4d755" /> 
			<meta name="locale" content="en-us" />
			 <meta name="adobe-target" content="true" />
			<meta name="uhfHeaderId" content="MSDocsHeader-Archive" />

			<meta name="page_type" content="conceptual" />

			<!--page specific meta tags-->
			

			<!-- custom meta tags -->
			
		<meta name="breadcrumb_path" content="/archive/msdn-magazine/breadcrumb/toc.json" />
	
		<meta name="feedback_system" content="None" />
	
		<meta name="ROBOTS" content="INDEX,FOLLOW" />
	
		<meta name="is_archived" content="true" />
	
		<meta name="author" content="kexugit" />
	
		<meta name="ms.author" content="Archiveddocs" />
	
		<meta name="ms.prod" content="msdn-magazine" />
	
		<meta name="ms.topic" content="Archived" />
	
		<meta name="TOCTitle" content="Faster Code with the Modern Language Features of Visual C++ 2005" />
	
		<meta name="ms:assetid" content="1cd6dfa2-116e-406e-b5c8-71f633abe596" />
	
		<meta name="ms:mtpsurl" content="https://technet.microsoft.com/en-us/library/Cc163971(v=MSDN.10)" />
	
		<meta name="ms:contentKeyID" content="14208838" />
	
		<meta name="ms.date" content="2019-10-11T00:00:00Z" />
	
		<meta name="mtps_version" content="v=MSDN.10" />
	
		<meta name="document_id" content="7a5ede29-ad1b-c6f0-16ff-db4f9b4df76e" />
	
		<meta name="document_version_independent_id" content="7a5ede29-ad1b-c6f0-16ff-db4f9b4df76e" />
	
		<meta name="updated_at" content="2022-01-21T03:47:00Z" />
	
		<meta name="original_content_git_url" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/msdn-magazine-archive-pr?path=/msdn-magazine-archive/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005.md&amp;version=GBlive&amp;_a=contents" />
	
		<meta name="gitcommit" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/msdn-magazine-archive-pr/commit/65cb603265929c7971672beaa81fcca59365ddea?path=/msdn-magazine-archive/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005.md&amp;_a=contents" />
	
		<meta name="git_commit_id" content="65cb603265929c7971672beaa81fcca59365ddea" />
	
		<meta name="site_name" content="Docs" />
	
		<meta name="depot_name" content="MSDN.msdn-magazine-archive" />
	
		<meta name="schema" content="Conceptual" />
	
		<meta name="toc_rel" content="toc.json" />
	
		<meta name="feedback_product_url" content="" />
	
		<meta name="feedback_help_link_type" content="" />
	
		<meta name="feedback_help_link_url" content="" />
	
		<meta name="word_count" content="6637" />
	
		<meta name="asset_id" content="2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005" />
	
		<meta name="moniker_range_name" content="" />
	
		<meta name="item_type" content="Content" />
	
		<meta name="source_path" content="msdn-magazine-archive/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005.md" />
	
		<meta name="previous_tlsh_hash" content="30D3B803B70D5720EFC29D17185BAB94A5F0C40DB5B06FD4153739A1C1DA3DA30BA454D9E36FA74C2775066312D2B29E52DAE32AC46D67B1099154AC823C33A38B8D3FF7FA" />
	
		<meta name="github_feedback_content_git_url" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/msdn-magazine-archive-pr?path=/msdn-magazine-archive/2004/may/faster-code-with-the-modern-language-features-of-visual-c-2005.md&amp;version=GBlive&amp;_a=contents" />
	 

			<!-- assets and js globals -->
			<link rel="stylesheet" href="/static/assets/0.4.030556769/styles/site-ltr.css" />
			<link rel="preconnect" href="//mscom.demdex.net" crossorigin />
						<link rel="dns-prefetch" href="//target.microsoft.com" />
						<link rel="dns-prefetch" href="//microsoftmscompoc.tt.omtrdc.net" />
						<link
							rel="preload"
							as="script"
							href="/static/third-party/adobe-target/at-js/2.9.0/at.js"
							integrity="sha384-1/viVM50hgc33O2gOgkWz3EjiD/Fy/ld1dKYXJRUyjNYVEjSUGcSN+iPiQF7e4cu"
							crossorigin="anonymous"
							id="adobe-target-script"
							type="application/javascript"
						/>
			<script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
			<script src="https://js.monitor.azure.com/scripts/c/ms.jsll-4.min.js"></script>
			<script src="/_themes/docs.theme/master/en-us/_themes/global/deprecation.js"></script>

			<!-- msdocs global object -->
			<script id="msdocs-script">
		var msDocs = {
  "environment": {
    "accessLevel": "online",
    "azurePortalHostname": "portal.azure.com",
    "reviewFeatures": false,
    "supportLevel": "production",
    "systemContent": true,
    "siteName": "learn",
    "legacyHosting": false
  },
  "data": {
    "contentLocale": "en-us",
    "contentDir": "ltr",
    "userLocale": "en-us",
    "userDir": "ltr",
    "pageTemplate": "Conceptual",
    "brand": "",
    "context": {},
    "standardFeedback": false,
    "showFeedbackReport": false,
    "feedbackHelpLinkType": "",
    "feedbackHelpLinkUrl": "",
    "feedbackSystem": "None",
    "feedbackGitHubRepo": "",
    "feedbackProductUrl": "",
    "extendBreadcrumb": true,
    "isEditDisplayable": false,
    "isPrivateUnauthorized": false,
    "hideViewSource": false,
    "isPermissioned": false,
    "hasRecommendations": false,
    "contributors": []
  },
  "functions": {}
};;
	</script>

			<!-- base scripts, msdocs global should be before this -->
			<script src="/static/assets/0.4.030556769/scripts/en-us/index-docs.js"></script>
			

			<!-- json-ld -->
			
		</head>
	
			<body
				id="body"
				data-bi-name="body"
				class="layout-body "
				lang="en-us"
				dir="ltr"
			>
				<header class="layout-body-header">
		<div class="header-holder has-default-focus">
			
		<a
			href="#main"
			
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			
		>
			Skip to main content
		</a>
	
		<a
			href="#"
			data-skip-to-ask-learn
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			hidden
		>
			Skip to Ask Learn chat experience
		</a>
	

			<div hidden id="cookie-consent-holder" data-test-id="cookie-consent-container"></div>
			<!-- Unsupported browser warning -->
			<div
				id="unsupported-browser"
				style="background-color: white; color: black; padding: 16px; border-bottom: 1px solid grey;"
				hidden
			>
				<div style="max-width: 800px; margin: 0 auto;">
					<p style="font-size: 24px">This browser is no longer supported.</p>
					<p style="font-size: 16px; margin-top: 16px;">
						Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.
					</p>
					<div style="margin-top: 12px;">
						<a
							href="https://go.microsoft.com/fwlink/p/?LinkID=2092881 "
							style="background-color: #0078d4; border: 1px solid #0078d4; color: white; padding: 6px 12px; border-radius: 2px; display: inline-block;"
						>
							Download Microsoft Edge
						</a>
						<a
							href="https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge"
							style="background-color: white; padding: 6px 12px; border: 1px solid #505050; color: #171717; border-radius: 2px; display: inline-block;"
						>
							More info about Internet Explorer and Microsoft Edge
						</a>
					</div>
				</div>
			</div>
			<!-- site header -->
			<header
				id="ms--site-header"
				data-test-id="site-header-wrapper"
				role="banner"
				itemscope="itemscope"
				itemtype="http://schema.org/Organization"
			>
				<div
					id="ms--mobile-nav"
					class="site-header display-none-tablet padding-inline-none gap-none"
					data-bi-name="mobile-header"
					data-test-id="mobile-header"
				></div>
				<div
					id="ms--primary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L1-header"
					data-test-id="primary-header"
				></div>
				<div
					id="ms--secondary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L2-header"
					data-test-id="secondary-header"
				></div>
			</header>
			
		<!-- banner -->
		<div data-banner>
			<div id="disclaimer-holder"></div>
			
		</div>
		<!-- banner end -->
	
		</div>
	</header>
				 <section
					id="layout-body-menu"
					class="layout-body-menu display-flex"
					data-bi-name="menu"
			  >
					<div
		id="left-container"
		class="left-container display-none display-block-tablet padding-inline-sm padding-bottom-sm width-full"
	>
		<nav
			id="affixed-left-container"
			class="margin-top-sm-tablet position-sticky display-flex flex-direction-column"
			aria-label="Primary"
		></nav>
	</div>
			  </section>

				<main
					id="main"
					role="main"
					class="layout-body-main "
					data-bi-name="content"
					lang="en-us"
					dir="ltr"
				>
					
			<div
		id="ms--content-header"
		class="content-header default-focus border-bottom-none"
		data-bi-name="content-header"
	>
		<div class="content-header-controls margin-xxs margin-inline-sm-tablet">
			<button
				type="button"
				class="contents-button button button-sm margin-right-xxs"
				data-bi-name="contents-expand"
				aria-haspopup="true"
				data-contents-button
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-menu"></span></span>
				<span class="contents-expand-title"> Table of contents </span>
			</button>
			<button
				type="button"
				class="ap-collapse-behavior ap-expanded button button-sm"
				data-bi-name="ap-collapse"
				aria-controls="action-panel"
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-exit-mode"></span></span>
				<span>Exit focus mode</span>
			</button>
		</div>
	</div>
			<div data-main-column class="padding-sm padding-top-none padding-top-sm-tablet">
				<div>
					
		<div id="article-header" class="background-color-body margin-bottom-xs display-none-print">
			<div class="display-flex align-items-center justify-content-space-between">
				
		<details
			id="article-header-breadcrumbs-overflow-popover"
			class="popover"
			data-for="article-header-breadcrumbs"
		>
			<summary
				class="button button-clear button-primary button-sm inner-focus"
				aria-label="All breadcrumbs"
			>
				<span class="icon">
					<span class="docon docon-more"></span>
				</span>
			</summary>
			<div id="article-header-breadcrumbs-overflow" class="popover-content padding-none"></div>
		</details>

		<bread-crumbs
			id="article-header-breadcrumbs"
			data-test-id="article-header-breadcrumbs"
			class="overflow-hidden flex-grow-1 margin-right-sm margin-right-md-tablet margin-right-lg-desktop margin-left-negative-xxs padding-left-xxs"
		></bread-crumbs>
	 
		<div
			id="article-header-page-actions"
			class="opacity-none margin-left-auto display-flex flex-wrap-no-wrap align-items-stretch"
		>
			
		<button
			class="button button-sm border-none display-none-tablet flex-shrink-0  "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-mobile"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-label="Ask Learn"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle gradient-ask-learn-logo"></span>
			</span>
		</button>
		<button
			class="button button-sm display-none display-inline-flex-tablet display-none-desktop flex-shrink-0  "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-tablet"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
		<button
			class="button button-sm display-none flex-shrink-0 display-inline-flex-desktop  "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-flyout-entry"
			data-ask-learn-flyout-entry
			data-flyout-button="toggle"
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-controls="ask-learn-flyout"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
	  
		<a
			id="lang-link-tablet"
			class="button button-primary button-clear button-sm display-none display-inline-flex-tablet"
			title="Read in English"
			data-bi-name="language-toggle"
			data-read-in-link
			href="#"
			hidden
		>
			<span class="icon margin-none" aria-hidden="true" data-read-in-link-icon>
				<span class="docon docon-locale-globe"></span>
			</span>
			<span class="is-visually-hidden" data-read-in-link-text>Read in English</span>
		</a>
	 
		<button
			type="button"
			class="collection button button-clear button-sm button-primary display-none display-inline-flex-tablet"
			data-list-type="collection"
			data-bi-name="collection"
		>
			<span class="icon margin-none" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="collection-status is-visually-hidden">Save</span>
		</button>
	 
			

			<details class="popover popover-right" id="article-header-page-actions-overflow">
				<summary
					class="justify-content-flex-start button button-clear button-sm button-primary"
					aria-label="More actions"
					title="More actions"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-more-vertical"></span>
					</span>
				</summary>
				<div class="popover-content">
					
		<button
			data-page-action-item="overflow-mobile"
			type="button"
			class="button-block button-sm has-inner-focus button button-clear display-none-tablet justify-content-flex-start text-align-left"
			data-bi-name="contents-expand"
			data-contents-button
			data-popover-close
		>
			<span class="icon">
				<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
			</span>
			<span class="contents-expand-title">Table of contents</span>
		</button>
	 
		<a
			id="lang-link-overflow"
			class="button-sm has-inner-focus button button-clear button-block justify-content-flex-start text-align-left display-none-tablet"
			title="Read in English"
			data-bi-name="language-toggle"
			data-page-action-item="overflow-mobile"
			data-check-hidden="true"
			data-read-in-link
			href="#"
			hidden
		>
			<span class="icon" aria-hidden="true" data-read-in-link-icon>
				<span class="docon docon-locale-globe"></span>
			</span>
			<span data-read-in-link-text>Read in English</span>
		</a>
	 
		<button
			type="button"
			class="collection button button-clear button-sm button-block justify-content-flex-start text-align-left inner-focus display-none-tablet"
			data-list-type="collection"
			data-bi-name="collection"
			data-page-action-item="overflow-mobile"
			data-check-hidden="true"
			data-popover-close
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="collection-status">Add</span>
		</button>
	
					
		<button
			type="button"
			class="collection button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus display-none-tablet"
			data-list-type="plan"
			data-bi-name="plan"
			data-page-action-item="overflow-mobile"
			data-check-hidden="true"
			data-popover-close
			hidden
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="plan-status">Add to plan</span>
		</button>
	  
		<hr class="display-none-tablet margin-block-xxs" />
		<h4 class="font-size-sm padding-left-xxs">Share via</h4>
		
					<a
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-facebook"
						data-bi-name="facebook"
						data-page-action-item="overflow-all"
						href="#"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-facebook-share"></span>
						</span>
						<span>Facebook</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-twitter"
						data-bi-name="twitter"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-text" aria-hidden="true">
							<span class="docon docon-xlogo-share"></span>
						</span>
						<span>x.com</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-linkedin"
						data-bi-name="linkedin"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-linked-in-logo"></span>
						</span>
						<span>LinkedIn</span>
					</a>
					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-email"
						data-bi-name="email"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-mail-message"></span>
						</span>
						<span>Email</span>
					</a>
			  
	 
		<hr class="margin-block-xxs" />
		<button
			class="button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus"
			type="button"
			data-bi-name="print"
			data-page-action-item="overflow-all"
			data-popover-close
			data-print-page
			data-check-hidden="true"
		>
			<span class="icon color-primary" aria-hidden="true">
				<span class="docon docon-print"></span>
			</span>
			<span>Print</span>
		</button>
	
				</div>
			</details>
		</div>
	
			</div>
		</div>
	
					<!-- privateUnauthorizedTemplate is hidden by default -->
					
		<div unauthorized-private-section data-bi-name="permission-content-unauthorized-private" hidden>
			<hr class="hr margin-top-xs margin-bottom-sm" />
			<div class="notification notification-info">
				<div class="notification-content">
					<p class="margin-top-none notification-title">
						<span class="icon">
							<span class="docon docon-exclamation-circle-solid" aria-hidden="true"></span>
						</span>
						<span>Note</span>
					</p>
					<p class="margin-top-none authentication-determined not-authenticated">
						Access to this page requires authorization. You can try <a class="docs-sign-in" href="#" data-bi-name="permission-content-sign-in">signing in</a> or <a  class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
					<p class="margin-top-none authentication-determined authenticated">
						Access to this page requires authorization. You can try <a class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
				</div>
			</div>
		</div>
	
					<div class="content"></div>
					
		<div
			id="article-metadata"
			class="display-flex gap-xxs justify-content-space-between align-items-center flex-wrap-wrap page-metadata-container"
		>
			
		<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
			<li class="">Article</li>   <li class="visibility-hidden-visual-diff">
			<local-time
				format="twoDigitNumeric"
				datetime="2019-10-11T00:00:00.000Z"
				data-article-date-source="ms.date"
				class="is-invisible"
			>
				2019-10-11
			</local-time>
		</li> 
			 
		</ul>
	 
				<div id="user-feedback" class="margin-block-xxs display-none-print" data-hide-on-archived>
					
		<button
			id="user-feedback-button"
			data-test-id="conceptual-feedback-button"
			class="button button-sm button-clear button-primary"
			type="button"
			data-bi-name="user-feedback-button"
			data-user-feedback-button
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-like"></span>
			</span>
			<span>Feedback</span>
		</button>
	
				</div>
		  
		</div>
	 
		<nav
			id="center-doc-outline"
			class="doc-outline is-hidden-desktop display-none-print margin-bottom-sm"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h2 id="ms--in-this-article" class="title is-6 margin-block-xs">
				In this article
			</h2>
		</nav>
	
					<div class="content"><p>C++</p>
<p>Write Faster Code with the Modern Language Features of Visual C++ 2005</p>
<p>Stephen Toub</p>
<p>This article was based on a pre-release version of Microsoft Visual Studio 2005, formerly code-named "Whidbey." All information contained herein is subject to change.</p>
<table>
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr class="odd">
<td><p>This article discusses:</p>
<ul>
<li>.NET C++/CLI syntax</li>
<li>Interop technologies</li>
<li>Profile Guided Optimization</li>
<li>MSIL optimization</li>
<li>OpenMP support</li>
<li>Enhanced buffer security checks</li>
</ul></td>
<td>This article uses the following technologies:<br>
Visual C++ .NET 2003, Visual C++ 2005<br>
</td>
</tr>
</tbody>
</table>
<p><strong>Contents</strong></p>
<p>C++/CLI—The New Syntax<br>
Interop Options<br>
It Just Works<br>
Optimizations<br>
Security<br>
Conclusion</p>
<p>The introduction of the Visual Studio® .NET 2003 C++ compiler was a mouthwatering experience for enthusiasts of the C++ language. With 98 percent conformance to the ISO C++ standard, Visual C++® .NET 2003 was truer to these standards than any previous version and incorporated language support for features such as partial template specialization. It also included enhanced buffer security checks and improved compiler diagnostics. C++ developers joined the ranks of developers using C# and Visual Basic® .NET who are able to use the drag and drop forms designer to build robust Windows® Forms applications. The compiler also included optimizations targeting the Intel Pentium 4 and AMD Athlon processors.</p>
<p>If you were excited about Visual C++ .NET 2003, you'll be in a frenzy over the next version, Visual C++ 2005. Visual C++ 2005 has a new syntax for development in .NET that is both elegant and powerful. It has new optimization technology that has improved the speed of Microsoft products up to 30 percent. It has new compilation modes that ensure Common Language Infrastructure (CLI) compliance and verifiability for the Microsoft® .NET Framework, and it has new models for interop that provide a seamless merging of the native and managed worlds as well as complete control over when these boundaries are crossed. The compiler includes an enhanced version of the buffer security check option present in the previous two versions, and it includes new security-focused versions of libraries in prevalent use by C++ applications. It has support for the OpenMP standard as well as for 64-bit platforms, including the Intel Itanium and AMD64 chips. It fixes the mixed DLL loading issue and provides automatic runtime elimination of the Double P/Invoke performance problem. The list of enhancements and improvements goes on and on. As one of the architects on the C++ team told me, "C++ is where it's at, man!"</p>
<p>C++/CLI—The New Syntax</p>
<p>How many of us found working with the Managed Extensions syntax of the previous two versions of C++ cumbersome and fraught with error? How many of us felt that Visual C++ wasn't being treated as a first-class .NET-based language? Apparently, most of us did (including the development group itself, if you read their blogs). The Visual C++ team heard our cries, and starting with Visual C++ 2005, the Managed Extensions for C++ syntax that was introduced with Visual Studio .NET 2002 is going the way of the dinosaurs as a revised language definition is introduced that brings with it an attractive new syntax.</p>
<p>The design team had a few major goals for this release in regard to the language design. First (and probably most important to those of us who think code is art), they wanted to make sure that writing C++ felt natural and that it provided an elegant syntax with pure extensions to the ISO C++ standard. They wanted to make it easy to write verifiable code in C++ in order to enable partial-trust scenarios such as ClickOnce deployment, Form design support and managed-code hosting in SQL Server™ 2005. They wanted to leave no room for a language "lower" than C++. They wanted to bring the complete power of .NET to C++, and at the same time bring the power of C++ to .NET. They've succeeded brilliantly in all aspects.</p>
<p>The specification for the new extensions is called C++/CLI and is now being standardized. To get a taste of the new language extensions, see the candidate base document that was posted online on November 21, 2003, and which is available for download at <a href="https://download.microsoft.com/download/9/9/c/99c65bcd-ac66-482e-8dc1-0e14cd1670cd/C++-CLI%20Standard.pdf" data-linktype="external">C++/CLI Language Specification</a>.</p>
<p>Most noticeably for anyone reading code in the new syntax, the common double-underscore keywords prevalent in Managed Extensions for defining garbage-collected classes, properties, and so on, are a thing of the past. While a few of these keywords remain and a few more are being introduced, they are infrequently used and won't muddy up the readability of the code. These double-underscore keywords are being replaced with two new types of keywords: context-sensitive and spaced. Context-sensitive keywords are only keywords when used in certain contexts, and spaced keywords are only keywords when used in combination with other keywords. For example, the __property keyword from Managed Extensions is replaced with the property keyword. (Not only that, but the entire syntax for defining a property and its accessors has been dramatically refined, making the declaration look very similar to what you might write in C#. See <strong>Figure 1</strong> for an example.) This doesn't prevent you from using "property" as the name of a variable in your code. A token parsed as "property" is only treated as a keyword when in the context of declaring a property on a type.</p>
<p><strong>Figure&nbsp;1&nbsp;Syntax Comparison</strong></p>
<p>Managed Extensions Syntax</p>
<pre><code>public __gc __sealed class Student { private: double m_grade; String* m_name; public: __property double get_Grade() { return m_grade; } __property void set_Grade(double newGrade) { m_grade = newGrade; } __property String* get_Name() { return m_name; } __property void set_Name(String* newName) { m_name = newName; } }
</code></pre>
<p>C++/CLI Syntax</p>
<pre><code>public ref class Student sealed { private: double m_grade; public: // standard property syntax property double Grade { double get() { return m_grade; } void set(double newGrade) { m_grade = newGrade; } } // trivial property // compiler can generate accessors and backing store property String^ Name; }
</code></pre>
<p>Types in the new syntax are declared with the form "adjective class", where the adjective describes what type of class you're creating, as shown in the following:</p>
<pre><code>class N { /*...*/ }; // native type ref class R { /*...*/ }; // CLR reference type value class V { /*...*/ }; // CLR value type interface class I { /*...*/ }; // CLR interface type enum class E { /*...*/ }; // CLR enumeration type
</code></pre>
<p>In previous versions of the language, the way a type was declared controlled where and how it lived. Only native classes or structs and managed value types could be created on the stack. Managed ref classes always lived on the managed heap. In Visual C++ 2005, all types, be they native or managed, can be created on the stack, with stack-based deterministic cleanup semantics.</p>
<p>To instantiate an object of type T to live on the native heap, use "new T". This returns a pointer to the location of the object on the native heap (a concept referred to as a __nogc pointer in Visual Studio .NET 2002 and Visual Studio .NET 2003). To instantiate an object of type T that should live on the managed heap, Visual C++ 2005 introduces the gcnew keyword to be used in the same manner as the new keyword. Calling "gcnew T" returns a handle to a whole object on the managed heap. A handle is a new construct introduced in Visual C++ 2005 that resembles the __gc pointer of Managed Extensions. To instantiate a type T on the stack, the standard "T t;" declaration suffices.</p>
<p>To be fair, I'm taking some liberties in how I define instantiation. Managed reference classes always live on the managed heap, and native types always live on the stack or on the native heap. When a managed reference type is declared to live on the stack, the compiler is in fact instantiating it on the managed heap, as shown in <strong>Figure 2</strong>.</p>
<p><img src="images/cc163971.fig02.gif" alt="Figure 2 Managed Ref Type on the Stack" data-linktype="relative-path"></p>
<p>Figure 2**&nbsp;Managed Ref Type on the Stack&nbsp;**</p>
<p>This begs some questions. What happens when my instance on the stack goes out of scope? How is it cleaned up? Many C# developers have complained about the C# language's lack of deterministic cleanup. The C# language provides the using keyword to make it easy to dispose of an IDisposable object, but this requires extra code and is clunky compared to the destructor pattern familiar to C++ developers. In C#, safe cleanup is off by default and requires explicit coding. For example, consider the first C# code snippet in <strong>Figure 3</strong>. The StreamReader object is declared on the managed heap. When this method finishes execution, no more references to the StreamReader instance remain. However, the object won't be finalized until the garbage collector runs. Until that time, the file will not be closed and the application will continue to hold onto its open file handle. To add deterministic cleanup, you must use the IDisposable interface implemented by classes that use unmanaged resources.</p>
<p><strong>Figure&nbsp;3&nbsp;Deterministic Cleanup</strong></p>
<table>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr class="header">
<th>Implemenation</th>
<th>Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C# without deterministic cleanup</td>
<td><p>&nbsp;</p>
<p>string ReadFirstLineFromFile(string path){ StreamReader reader = new StreamReader(path); return reader.ReadLine();})</p></td>
</tr>
<tr class="even">
<td>C# with deterministic cleanup</td>
<td><p>&nbsp;</p>
<p>string ReadFirstLineFromFile(string path){ using (StreamReader reader = new StreamReader(path)) { return reader.ReadLine(); }}</p></td>
</tr>
<tr class="odd">
<td>Visual Basic .NET with deterministic cleanup</td>
<td><p>&nbsp;</p>
<p>Function ReadFirstLineFromFile( _ ByVal path As String) As String Dim reader As StreamReader Try reader = New StreamReader(path) ReadFirstLineFromFile = reader.ReadLine() Finally If Not reader Is Nothing Then _ CType(reader, IDisposable).Dispose() End TryEnd Function</p></td>
</tr>
<tr class="even">
<td>C++ with deterministic cleanup</td>
<td><p>&nbsp;</p>
<p>String^ ReadFirstLineFromFile(String^ path){ StreamReader reader(path); return reader.ReadLine();}</p></td>
</tr>
</tbody>
</table>
<p>The second code sample in <strong>Figure 3</strong> shows what the new code in C# looks like. Not horrible, and still readable, but as you start introducing more objects that require cleanup, your code becomes harder and harder to read. Also, any objects you forget to dispose will put additional pressure on the finalizer thread when the garbage collector eventually does run. In the meantime, you could possibly lock up valuable resources. This becomes even uglier when viewing the equivalent implementation in Visual Basic .NET, also shown in <strong>Figure 3</strong> (although Visual Basic 2005 gains a Using statement similar to that in C#).</p>
<p>Visual C++ 2005 now provides the ability to have destructors and/or finalizers on any type, regardless of whether it is managed or native. In the case where the type is managed, the compiler maps the destructor to the IDisposable::Dispose method. This means that you can write the same method in C++ using the fourth snippet in <strong>Figure 3</strong>, where reader's destructor/Dispose method will automatically be called just as if you were using the "using" statement in C#. When a type is created on the stack, its destructor is invoked when it goes out of scope.</p>
<p>One of the biggest problems with Managed Extensions was working with pointers. Pointers were used for a variety of tasks and in a variety of situations, and as such were very difficult to understand. Deciphering which kind of pointer you were dealing with in any given piece of code required intelligence somewhere on the level of genius. That complexity is removed in this next version. In Visual C++ 2005, pointers are plain old C++ pointers. They point to an object that is stable, and you can perform arithmetic with them. Pointers refer to objects whose lifetime must be explicitly managed by the developer. When dealing with a pointer, it is not the runtime's responsibility to clean up after it.</p>
<p>Now let's see how the designers of Visual C++ 2005 have pulled this off. Unlike the new operator which in both Visual Studio .NET 2003 and Visual Studio 2005 returns a pointer, the gcnew operator returns a "handle," a new construct represented in the syntax by a caret (^). Handles refer to whole objects on the managed heap. That is, they cannot be used to point to the interior of types, and the compiler has a number of restrictions on their usage that enforce this behavior and that help the developer to use them correctly and safely. Handles do not allow pointer arithmetic, nor can they be cast to a void pointer or to any integral type. The asterisk and arrow operators are still used to dereference it, however.</p>
<p>This doesn't mean you can no longer acquire a pointer to something on the garbage collected heap. Similar to a combination of the &amp; operator and the fixed keyword in C#, the pin_ptr abstraction in Visual C++ 2005 allows you to retrieve a pinning pointer to an object on the managed heap. As long as this pointer is in existence, the object on the managed heap will be pinned, preventing the garbage collector from moving it around during a collection. Visual C++ 2005 also introduces the tracking reference operator, notated with a percent sign (%). When introduced to the native &amp; reference operator in C++, most developers learn to understand it as a pointer to an object that is automatically dereferenced by the compiler upon usage. In most respects, % is to ^ as &amp; is to *.</p>
<p>In the managed world, having native references to managed objects is just as dangerous as having native pointers to managed objects. The fundamental reasoning behind pointers and references is that the referenced objects don't move around. The tracking reference is similar to the native reference except that it references objects on the managed heap and "tracks" them even if they are moved by the garbage collector. The percent sign operator is also used to "take the address of" managed objects, so just as the &amp; operator when applied to a native type returns a pointer to that object, the % operator when applied to a managed reference type returns a handle to that object.</p>
<p>In general, C++ developers are at peace knowing that standards control their language. For this reason, to promote adoption by third parties, and to ensure the stability of the language going forward, this new syntax has been pulled together into a proposed standard known as C++/CLI. In October of 2003, ECMA voted to create a special task force, called TG5, dedicated to the analysis and adoption of this standard, just as WG21 serves as the governing body for ISO C++. In fact, key players in WG21 are also serving in TG5. The plan is to have this standardized by the end of 2004.</p>
<p>Interop Options</p>
<p>Visual C++ 7.1 provided the best interop functionality of any of the .NET Framework-based languages in Visual Studio .NET 2003. It has the necessary power to implement real-world interop scenarios, as exemplified by the port of Quake II to the .NET Framework, available at <a href="https://www.vertigo.com/quake2.htm" data-linktype="external">https://www.vertigo.com/Quake2.htm</a>. Visual C++ 2005 extends this functionality further.</p>
<p>There are four main ways to do interop in .NET between the managed and native worlds. COM interop can be accomplished using Runtime Callable Wrappers (RCW) and COM Callable Wrappers (CCW). The common language runtime (CLR) is responsible for type marshaling (except in the rare scenarios where a custom marshaler is used) and the cost of these calls can be expensive. You need to be careful that the interfaces are not too chatty; otherwise a large performance penalty could result. You also need to ensure that the wrappers are kept up to date with the underlying component. That said, COM interop is very useful for simple interop scenarios where you are attempting to bring in a large amount of native COM code.</p>
<p>The second option for interop is to use P/Invoke. This is accomplished using the DllImport attribute, specifying the attribute on the method declaration for the function you want to import. Marshaling is handled according to how it has been specified in the declaration. However, DllImport is only useful if you have code that exposes the required functions through a DLL export.</p>
<p>When you need to call managed code from native code, CLR hosting is an option. In such a scenario, the native application has to drive all of the execution: setting up the host, binding to the runtime, starting the host, retrieving the appropriate AppDomain, setting up the invocation context, locating the desired assembly and class, and invoking the operation on the desired class. This is definitely one of the most robust solutions in terms of control over what and when things happen, but it is also incredibly tedious and requires a lot of custom code.</p>
<p>The fourth option, and quite possibly the easiest and the most performant, is to use the interop capabilities in C++. By throwing the /clr switch, the compiler generates MSIL instead of native machine code. The only code that is generated as native machine code is code that just can't be compiled to MSIL, including functions with inline asm blocks and operations that use CPU-specific intrinsics such as Streaming SIMD Extensions (SSE). The /clr switch is how the Quake II port to .NET was accomplished. The Vertigo software team spent a day porting the original C code for the game to code that successfully compiled as C++ and then threw the /clr switch. In no time they were up and running on the .NET Framework. Without adding any additional binaries and simply by including the appropriate header files, managed C++ and native C++ can call each other without any additional work on the part of the developer. The compiler handles the creation of the appropriate thunks to go back and forth between the two worlds.</p>
<p>This resulted in some issues for C++ developers. One of these issues was the now infamous mixed DLL loading problem that affected users of Visual Studio .NET 2002 and Visual Studio .NET 2003. If you're running native code inside the loader lock and you reference a managed type in an assembly that hasn't yet been loaded, the CLR will kindly load the assembly for you. It does this by calling LoadLibrary. Of course, LoadLibrary attempts to acquire the loader lock, at which point you're deadlocked. Developers and product managers alike will be happy to hear that this problem has been solved in the upcoming version.</p>
<p>The /clr switch was a huge boon for C++ developers, but it did have some downsides. As mentioned earlier, the images produced with the /clr switch contained both native and managed code, which sometimes caused problems. First, these mixed images are not CLI-compliant (meaning that, for example, they will not run on Rotor). They have native entry points, and there are often significant transition penalties as you continually cross the managed boundaries. But most importantly, the existence of native entry points can wreak havoc on tools that consume the assemblies, including reflection. In order for reflection to inspect an image, it must first load the assembly and execute it. Only once all initialization has taken place is reflection able to inspect the metadata. Unfortunately, reflection cannot correctly load a managed assembly that contains native entry points.</p>
<p>Moreover, Visual Studio .NET 2003 rarely produced verifiable code, and even when it did, the effort it took in nontrivial cases was often significant. While MSIL has first-class support for unverifiable instructions (you can do pointer arithmetic, perform indirect loads, and access the native heap), verifiable code gives you the ability to engage in partial trust scenarios which, in turn, enables the rich set of features available in Visual Studio 2005. ClickOnce deployment relies on partial trust, as does managed code hosting in SQL Server 2005. One of the major goals the C++ development team had for Visual C++ 2005 was to enable the compiler to aid the developer in the production of non-mixed and verifiable images. They've done so with the introduction of two new compiler switches: /clr:pure and /clr:safe. But before I delve into these new switches, I need to examine how C++ interop functions.</p>
<p>It Just Works</p>
<p>In Visual Studio .NET 2003, the C++ interop technology was known as IJW, or "It Just Works." For the upcoming version, this has been renamed to the more descriptive "Interop Technologies." So how does it "just work?" For every native method used by the application, the compiler creates both a managed and an unmanaged entry point. One of them is the actual method implementation, while the other is a forwarding thunk that creates the appropriate transition and performs any necessary marshaling. The managed entry point is almost always the actual method implementation, except when the code for that method can't be expressed in MSIL or when a developer uses the "#pragma unmanaged" compiler directive to force the implementation of the entry point to be native machine code.</p>
<p>When an IJW forwarding thunk is used (for example, when the native entry point is the forwarding thunk), the compiler provides the implementation for the thunk and the call into the actual implementation through an offset or an Import Address Table (IAT) jump. A reasonable amount of time for an IJW thunk is somewhere on the order of 50 to 300 cycles, though contrived test cases can be developed to get that number down to as little as 10. When the forwarding thunk is MSIL, a managed P/Invoke is used. P/Invokes consist only of a declaration and no actual method implementation; the CLR supplies the functionality for the thunk at run time. These forwarding thunks are often slightly slower than their native equivalents.</p>
<p>As mentioned, a consequence of IJW is two entry points for each function, one managed and one unmanaged. But certain constructs require call sites to these entry points to be populated at compile time (function pointers and vtables, for example). Which entry point should the compiler choose, given that it can't know at compile time the managed state of the call site at run time? In Visual Studio .NET 2003, the unmanaged entry point was always selected by the compiler. This, of course, creates a problem if the caller is indeed managed, an issue known as the Double P/Invoke problem, illustrated in <strong>Figure 4</strong>. In such a scenario, the managed call transitions to the unmanaged thunk only to transition again right back to managed code, operations resulting in a significant amount of unnecessary overhead.</p>
<p><img src="images/cc163971.fig04.gif" alt="Figure 4 Double P/Invoke Problem" data-linktype="relative-path"></p>
<p>Figure 4**&nbsp;Double P/Invoke Problem&nbsp;**</p>
<p>Visual C++ 2005 provides a few solutions. The first is the __clrcall keyword which lets you specify whether to emit an unmanaged entry point on a method-by-method basis. Augmenting a function declaration with this keyword will prevent the generation of an unmanaged entry point (a downside to this is that the function can no longer be called directly from native code). The __clrcall keyword can also be placed on a function pointer, causing it to be populated with a managed entry point should the compiler have a choice. The second solution provided by Visual C++ 2005 is the automatic elimination of the Double P/Invoke using runtime checks and a cookie that will help the runtime determine whether the unmanaged thunk can be skipped, forwarding the call directly to the managed entry point. This feature, however, may not make it into the final bits.</p>
<p>The third solution is pure MSIL. The new /clr:pure compiler flag instructs the compiler to generate a pure managed image with no native constructs. Not only does this produce CLI-compliant assemblies that enable partial trust scenarios, it also solves the Double P/Invoke problem by preventing the generation of the unmanaged thunk. As a result, there's only one entry point for every function (the managed entry point), so vtables and function pointers are never populated with an unmanaged entry point.</p>
<p>Just because code is CLI-compliant, however, doesn't mean it's verifiable, which is an important goal for enabling low trust scenarios such as when code is loaded from a file share. To that end, Microsoft has introduced an even stricter compiler flag called /clr:safe. This is the holy grail of verifiability for C++ developers. Throwing this switch causes the compiler to ensure that the generated assembly is completely verifiable; any unverifiable constructs will result in a compile-time error. For example, attempting to compile with an integer pointer as a variable will result in the error "int* = this type is not verifiable" referencing the specific line containing the invalid construct. There are a some scenarios where it's appropriate to go to this extreme. For example, all managed C++ code to be run as a stored procedure in SQL Server 2005 should be compiled with this flag.</p>
<p><img src="images/cc163971.fig05.gif" alt="Figure 5 Compilation Modes" data-linktype="relative-path"></p>
<p>Figure 5**&nbsp;Compilation Modes&nbsp;**</p>
<p><strong>Figure 5</strong> diagrams the managed and unmanaged worlds of data and code and shows which of them are targeted with the different compiler flags. Not including any of the /clr flags will result in the generation of a completely native image. Using /clr will result in a mixed image that can contain both managed and unmanaged code and data. Pure MSIL, generated by using the /clr:pure flag, will not contain any unmanaged code, though it is still not guaranteed to be verifiable and can contain native types. Safe MSIL is the ultimate in verifiability, targeting only the .NET Framework. In short, these two new compilation modes will enable a wide variety of scenarios that either weren't possible before or that were very difficult to accomplish.</p>
<p>Optimizations</p>
<p>All good software developers want to ensure that their software performs. Compiler writers are a special kind of developer; not only must their code perform, but the code that their code generates must be as efficient as is possible. For this reason, a good optimizing back end is essential to the success of any compiler. Here, Visual C++ 2005 strikes gold.</p>
<p>Visual Studio .NET 2002 and Visual Studio .NET 2003 saw some terrific optimizations added to the C++ compiler as lots of work was done to improve the performance of native code. Support was added for targeting the Intel Pentium IV chip as well as the SSE and SSE2 architectures. Most notably, Whole Program Optimization (WPO) was added, allowing the linker to optimize the entire program when presented with the .obj files for each of the compiled .cpp files. These object files were different from normal object files because rather than containing native machine code, they contained an intermediate language used to communicate between the front and back ends of the compiler. The linker was then able to optimize all of these files as a large unit, providing for more inlining opportunities, better stack alignment options, and the possibility of using custom calling conventions in various scenarios, among other optimizations. Visual C++ 2005 improves upon WPO with a new feature referred to as Bottom-Up, Top-Down analysis. But the big improvement comes in the form of Profile Guided Optimization (POGO), a brand new feature in the compiler that is going to make some performance waves.</p>
<p>Static analysis of source code leaves many open questions for a compiler. Given an if statement that compares two variables, how often will the first be greater than the second? Which of the cases in a switch statement is targeted the most? Which functions are used the most, and which code is often the coldest? If the compiler could know at compile time how the code was going to be used at run time, it could optimize for common scenarios. That's exactly what the Visual C++ 2005 compiler can do.</p>
<p><img src="images/cc163971.fig06.gif" alt="Figure 6 Profile Guided Optimization" data-linktype="relative-path"></p>
<p>Figure 6**&nbsp;Profile Guided Optimization&nbsp;**</p>
<p>The process for compiling for POGO is shown in <strong>Figure 6</strong>. The first steps involve compiling the code and linking it into an instrumented build filled with a set of profiling probes. As with WPO, the object files generated by the compiler and fed to the linker are comprised of an intermediate language rather than native machine code. These probes come in two flavors: value probes and count probes. Value probes are used to construct a histogram of the values that variables hold, while count probes are used to keep track of the number of times you traverse a particular path through the application. When the application is run and put through normal use, data is gathered from all of these probes and written to a profile database. Along with the original .obj files fed to the linker, this profile data can then be fed back into the linker. The linker is able to analyze the profile data, determine additional optimizations that should be applied, and spit out a new non-instrumented build of the application. It is this compiled version and not the instrumented version that should be distributed to customers.</p>
<p>Profile Guided Optimization enables a wide variety of optimizations. Based on the count probes, inlining decisions can be made at each function call site. Value probes enable switch and if-else constructs to be reordered so as to pull out the most frequent values and avoid the extra unnecessary checks before hitting the frequent case. Sections of code can be reordered so that the most frequent paths fall through rather than forcing unnecessary jumps around the code. This avoids costly Translation Lookaside Buffer (TLB) thrashing and paging.</p>
<p>Cold code can be placed in special sections of the module, which also helps to avoid these issues. Virtual call speculation can be performed so that virtual call sites that often result in a call made on a specific type can avoid the vtable lookup in the common cases. Partial inlining can be performed, whereby only the hot sections of functions can be inlined and the decision to do so made on a call site by call site basis. Additionally, certain sections of code can be compiled with certain optimization goals in mind, while other sections are compiled with different goals. For example, hot and/or small functions can be compiled to maximize speed (/O2), while colder and/or bigger functions can be compiled to minimize space (/O1).</p>
<p>If you understand your real-world scenarios and can put your apps through common use cases while instrumented, the performance gains can be tremendous. Recently, SQL Server was recompiled using POGO and obtained a whopping performance boost of up to 30 percent in many common scenarios. Moving forward, you can bet that Microsoft will start compiling many of its products with this technology. Note that it is very important not to attempt complete code coverage when profiling your instrumented build. The whole point of POGO is to determine how the common use cases can be optimized. By attempting complete code coverage, you'll be severely penalizing yourself.</p>
<p>Visual C++ 2005 also adds support for OpenMP, an open specification for building multithreaded programs. It consists of a set of pragmas used to instruct the compiler as to which sections of your code can be parallelized. Code with large loops lacking dependencies on previous iterations is most suited for OpenMP. Take a look at the following simple copy function that adds the values from arrays a and b and stores the results in c:</p>
<pre><code>void copy(int a[], int b[], int c[], int length) { #pragma omp parallel for(int i=0; i&lt;length; i++) { c[i] = a[i] + b[i]; } }
</code></pre>
<p>For a multiprocessor machine, the compiler will generate multiple threads to execute the iterations of this loop, and each thread will perform a subset of the copy operations. Note that the compiler cannot verify whether the loop has dependencies and thus will not stop you from using these pragmas in improper scenarios. If there are dependencies, you'll most likely get incorrect results according to what you expect from your code, though they will be correct with regards to the specification.</p>
<p>While the biggest gains with OpenMP often come from parallelizing loops as in the example just shown, straight-line code can also exhibit improvement. The "#pragma omp section" directive can be used to demark non-dependent sections in a piece of code, allowing the developer to specify regions that can be run in parallel. The compiler can then generate multiple threads to execute these sections on different processors.</p>
<p>In an important change for developers using .NET, the Visual C++ 2005 optimizer performs most of the same optimizations when targeting MSIL as it does when targeting the native platform, though it does so with different tuning. While the just-in-time (JIT) compiler today analyzes for optimizations at run time, allowing the C++ compiler to optimize during the initial compilation can still provide significant performance benefits (the C++ compiler has much more time to perform its analysis than does the JIT). The Visual C++ 2005 compiler optimizes managed types for the first time, performing loop optimizations, expression optimizations, and inlining. There are places, though, where the compiler can't optimize .NET-based code. For example, it has problems with strength reduction due to the unverifiability of pointer arithmetic, and certain code can't be inlined due to the strict type and member accessibility requirements of the CLR, though it does do significant analysis for legal inlining opportunities. In addition, optimizing MSIL introduces the need to make trade-offs concerning what is presented to the JIT compiler. For example, you wouldn't want to unroll a loop and expose a plethora of variables to the JIT compiler, whereupon it would have to perform register allocation (an NP-complete problem). The Visual C++ team is working through these issues and will have a very well-tuned optimizing solution by the time the system is released.</p>
<p>Security</p>
<p>The Trustworthy Computing initiative, announced by Bill Gates in 2002, has had a noticeable impact on all products developed by Microsoft. Developers for the Windows operating system spent months in security training and code reviews, which resulted in making Windows Server™ 2003 the most secure operating system the company has ever released. Microsoft Office 2003 includes many security features, such as Information Rights Management (IRM), better macro security, and HTML download blocking in Outlook®. The compiler teams are also taking strides towards making their compilers and the code they generate more secure.</p>
<p>Visual Studio .NET 2002 introduced a buffer security check /GS compiler option. This flag causes the compiler to allocate space on the stack before the return address for functions that the compiler decides are susceptible to buffer overrun attacks. On function entry, a security cookie with a known computed value is placed into this buffer, and on function exit it is checked to ensure that the cookie has not been corrupted. A change in cookie value could signify a potential overwriting of the return address, and as a result an error will be generated and the application terminated.</p>
<p>Of course, this doesn't prevent all buffer overrun attacks. Visual Studio .NET 2003 augmented the /GS feature by sorting local variables on the stack so that arrays were allocated in memory addresses higher than the rest of the local variables, shielding these local variables from overruns. This can deter attacks based on vtable hijacking and other pointer-based hacks.</p>
<p><img src="images/cc163971.fig07.gif" alt="Figure 7 0ld /GS" data-linktype="relative-path"></p>
<p>Figure 7**&nbsp;0ld /GS&nbsp;**</p>
<p>Visual C++ 2005 brings another update to this powerful feature. When a function call is made, the function activation record is laid out as shown in <strong>Figure 7</strong>. If one of the local buffers is overrun, an attacker could potentially overwrite everything above it on the stack, including the exception handler record, the security cookie, the frame pointer, the return address, and the function's arguments. Most of these values are protected by various mechanisms (such as safe exception handling), however it is still possible to exploit a buffer overrun in a function which has function pointer parameters. If a function takes a function pointer (or a struct or class that contains a function pointer) as an argument, an attacker could potentially overwrite the value in this pointer and cause the code to execute any function he or she wants to run. To combat this, the Visual C++ 2005 compiler analyzes all function parameters for this vulnerability and lays out the function activation record as shown in <strong>Figure 8</strong>. Copies of the vulnerable parameters are placed below the local variables on the stack, and these copies are then used instead of the originals. Should the originals be overwritten by a buffer overrun, they won't be exploitable as the copy being used will still retain the original value.</p>
<p><img src="images/cc163971.fig08.gif" alt="Figure 8 New /GS" data-linktype="relative-path"></p>
<p>Figure 8**&nbsp;New /GS&nbsp;**</p>
<p>In accordance with the "secure by default" Trustworthy Computing directive, the Visual C++ 2005 compiler now enables the buffer security check option by default. This will help make all products compiled with Visual C++ more secure. In fact, Microsoft is now building all of its products, including Windows, Office, and SQL Server, with this option enabled.</p>
<p>Other strides are being taken in Visual C++ 2005 to ensure that code is developed with security in mind. A large majority of C++ applications have dependencies on the C Runtime libraries (CRT) and on the Standard Template Libraries (STL). When these were first designed, code security was not a high priority, nor were many of the attacks in use today commonplace. As a result, much of the functionality provided by these libraries is often used in an insecure manner, opening up applications to potential attacks. Recent books like Michael Howard's <em>Writing Secure Code</em> (Microsoft Press® 2002) have stressed the importance of certain coding practices not exemplified by these libraries.</p>
<p>With Visual C++ 2005, Microsoft is introducing new versions of these libraries that are rewritten in an effort to identify all functions that could lead to common security issues and to provide alternate versions that are more secure. The long term goal of this effort is to deprecate all "insecure" versions in favor of their more robust counterparts. Over 400 new "safe" functions are being introduced in this new version of the CRT alone, ensuring that all pointer parameters are checked for null values, and all functions that perform memory copy operations take the number of bytes to be copied in addition to the destination and source buffers.</p>
<p>Conclusion</p>
<p>There is so much more available in Visual C++ 2005 that it's hard to stop writing about it all: delayed CLR loading for mixed images, the native AppDomains API, new declspecs for better global variable support with respect to AppDomains and processes, module constructors, linker support for object files and .NET modules, implicit boxing, XML comments using the same syntax C# developers have come to love, a brand new version of STL targeting the .NET Framework, param arrays, alias hints, a new floating point model, operator overloading, and on and on.</p>
<p>A new version of any .NET Framework-based language often causes people to ask "what language should my team use if we're writing an app targeting .NET?" Today, if you're doing a lot of native interop work, it's simple. C++ is the easiest language to use for native interop and is often the most performant. Additionally, if you're bringing an existing C++ app forward to .NET, there's really no better way. In fact, Visual C++ is the path most recommended by Microsoft when converting your existing apps to the .NET Framework.</p>
<p>As for new applications, you might ask why developers uninitiated in the world of .NET choose one .NET-based language over another. There is no straightforward answer as each language has its own strengths, but for pure .NET-based applications, the experience in C#, Visual Basic, and C++ is basically the same. If, as a developer, you are already comfortable in a particular language, there is no significant reason to switch to another one.</p>
<p>You might choose C++ over other languages, however, if you're doing any sort of interop. The experience in C++ is almost certain to be nicer than other languages due to the extensive interop support built directly into the language. In addition, the deterministic cleanup it provides through destructors is invaluable when it comes to eliminating resource leakage and ensuring the correctness of your applications. C++ also has many powerful features that can be used in combination with those provided by the CLR. For example, C++ not only supports both templates and generics, but it supports them in combination. This allows for more expressiveness and power than using the individual features alone. In particular, a useful library-writing technique is to write a template that implements a generic interface. This gives you all of the flexibility and power of templates, such as specialization, while still giving other languages the ability to directly use the objects instantiated from the template through the generic interface. All in all, C++ really is where it's at.</p>
<p><strong>Stephen Toub</strong> is the Technical Editor for MSDN Magazine. You can reach him at <a href="mailto:stoub@microsoft.com" data-linktype="external">stoub@microsoft.com</a>.</p>
</div>
					
		<div
			id="ms--inline-notifications"
			class="margin-block-xs"
			data-bi-name="inline-notification"
		></div>
	 
		<div
			id="assertive-live-region"
			role="alert"
			aria-live="assertive"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
		<div
			id="polite-live-region"
			role="status"
			aria-live="polite"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
	
					
				</div>
				
		<div id="ms--additional-resources-mobile" class="display-none-desktop display-none-print">
			<hr class="hr" hidden />
			<h2 id="ms--additional-resources-mobile-heading" class="title is-3" hidden>
				Additional resources
			</h2>
			 
		<section
			id="right-rail-training-mobile"
			class=""
			data-bi-name="learning-resource-card"
			hidden
		></section>
	 
		<section
			id="right-rail-events-mobile"
			class=""
			data-bi-name="events-card"
			hidden
		></section>
	 
		<section
			id="right-rail-qna-mobile"
			class="margin-top-xxs"
			data-bi-name="qna-link-card"
			hidden
		></section>
	
		</div>
	
			</div>
			
		<div
			id="action-panel"
			role="region"
			aria-label="Action Panel"
			class="action-panel"
			tabindex="-1"
		></div>
	
		
				</main>
				<aside
					id="layout-body-aside"
					class="layout-body-aside "
					data-bi-name="aside"
			  >
					
		<div
			id="ms--additional-resources"
			class="right-container padding-sm display-none display-block-desktop height-full"
			data-bi-name="pageactions"
			role="complementary"
			aria-label="Additional resources"
		>
			<div id="affixed-right-container" data-bi-name="right-column">
				<h2 id="ms--additional-resources-heading" class="title is-6 margin-top-xxs" hidden>
					Additional resources
				</h2>
				
		<section
			id="right-rail-events"
			class=""
			data-bi-name="events-card"
			hidden
		></section>
	 
		<section
			id="right-rail-training"
			class=""
			data-bi-name="learning-resource-card"
			hidden
		></section>
	 
				
		<nav
			id="side-doc-outline"
			class="doc-outline"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h3>In this article</h3>
		</nav>
	 
		<section
			id="right-rail-qna"
			class="margin-top-xxs"
			data-bi-name="qna-link-card"
			hidden
		></section>
	
			</div>
		</div>
	
			  </aside> <section
					id="layout-body-flyout"
					class="layout-body-flyout "
					data-bi-name="flyout"
			  >
					 <div
	class="height-full border-left background-color-body-medium"
	id="ask-learn-flyout"
></div>
			  </section> <div class="layout-body-footer " data-bi-name="layout-footer">
		<footer
			id="footer"
			data-test-id="footer"
			data-bi-name="footer"
			class="footer-layout has-padding has-default-focus border-top  uhf-container"
			role="contentinfo"
		>
			<div class="display-flex gap-xs flex-wrap-wrap is-full-height padding-right-lg-desktop">
				
		<a
			data-mscc-ic="false"
			href="#"
			data-bi-name="select-locale"
			class="locale-selector-link flex-shrink-0 button button-sm button-clear external-link-indicator"
			id=""
			title=""
			><span class="icon" aria-hidden="true"
				><span class="docon docon-world"></span></span
			><span class="local-selector-link-text">en-us</span></a
		>
	
				<div class="ccpa-privacy-link" data-ccpa-privacy-link hidden>
		
		<a
			data-mscc-ic="false"
			href="https://aka.ms/yourcaliforniaprivacychoices"
			data-bi-name="your-privacy-choices"
			class="button button-sm button-clear flex-shrink-0 external-link-indicator"
			id=""
			title=""
			>
		<svg
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 30 14"
			xml:space="preserve"
			height="16"
			width="43"
			aria-hidden="true"
			focusable="false"
		>
			<path
				d="M7.4 12.8h6.8l3.1-11.6H7.4C4.2 1.2 1.6 3.8 1.6 7s2.6 5.8 5.8 5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff"
			></path>
			<path
				d="M22.6 0H7.4c-3.9 0-7 3.1-7 7s3.1 7 7 7h15.2c3.9 0 7-3.1 7-7s-3.2-7-7-7zm-21 7c0-3.2 2.6-5.8 5.8-5.8h9.9l-3.1 11.6H7.4c-3.2 0-5.8-2.6-5.8-5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#06f"
			></path>
			<path
				d="M24.6 4c.2.2.2.6 0 .8L22.5 7l2.2 2.2c.2.2.2.6 0 .8-.2.2-.6.2-.8 0l-2.2-2.2-2.2 2.2c-.2.2-.6.2-.8 0-.2-.2-.2-.6 0-.8L20.8 7l-2.2-2.2c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0l2.2 2.2L23.8 4c.2-.2.6-.2.8 0z"
				style="fill:#fff"
			></path>
			<path
				d="M12.7 4.1c.2.2.3.6.1.8L8.6 9.8c-.1.1-.2.2-.3.2-.2.1-.5.1-.7-.1L5.4 7.7c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0L8 8.6l3.8-4.5c.2-.2.6-.2.9 0z"
				style="fill:#06f"
			></path>
		</svg>
	
			<span>Your Privacy Choices</span></a
		>
	
	</div>
				<div class="flex-shrink-0">
		<div class="dropdown has-caret-up">
			<button
				data-test-id="theme-selector-button"
				class="dropdown-trigger button button-clear button-sm has-inner-focus theme-dropdown-trigger"
				aria-controls="{{ themeMenuId }}"
				aria-expanded="false"
				title="Theme"
				data-bi-name="theme"
			>
				<span class="icon">
					<span class="docon docon-sun" aria-hidden="true"></span>
				</span>
				<span>Theme</span>
				<span class="icon expanded-indicator" aria-hidden="true">
					<span class="docon docon-chevron-down-light"></span>
				</span>
			</button>
			<div class="dropdown-menu" id="{{ themeMenuId }}" role="menu">
				<ul class="theme-selector padding-xxs" data-test-id="theme-dropdown-menu">
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="light"
						>
							<span class="theme-light margin-right-xxs">
								<span
									class="theme-selector-icon border display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Light </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="dark"
						>
							<span class="theme-dark margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Dark </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="high-contrast"
						>
							<span class="theme-high-contrast margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> High contrast </span>
						</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
			</div>
			<ul class="links" data-bi-name="footerlinks">
				<li class="manage-cookies-holder" hidden=""></li>
				<li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/previous-versions/"
			data-bi-name="archivelink"
			class=" external-link-indicator"
			id=""
			title=""
			>Previous Versions</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog"
			data-bi-name="bloglink"
			class=" external-link-indicator"
			id=""
			title=""
			>Blog</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/contribute"
			data-bi-name="contributorGuide"
			class=" external-link-indicator"
			id=""
			title=""
			>Contribute</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://go.microsoft.com/fwlink/?LinkId=521839"
			data-bi-name="privacy"
			class=" external-link-indicator"
			id=""
			title=""
			>Privacy</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/legal/termsofuse"
			data-bi-name="termsofuse"
			class=" external-link-indicator"
			id=""
			title=""
			>Terms of Use</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://www.microsoft.com/legal/intellectualproperty/Trademarks/"
			data-bi-name="trademarks"
			class=" external-link-indicator"
			id=""
			title=""
			>Trademarks</a
		>
	
	</li>
				<li>&copy; Microsoft 2025</li>
			</ul>
		</footer>
	</footer>
			</body>
		</html>