<!-- 
CITYDESK NOTE: No header, footer, or the following html elements should exist in this document:
HTML, HEAD, DOCTYPE, LINK, META, BODY. They are handled via include files.
Also, each include file should start and end on its own line.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>Xona Games -

Visual C++ .NET Standard Edition - Free Optimizing Compiler
	</title>

	<link title="RSS" type="application/rss+xml" rel="alternate" href="/rss.xml" />
	<link rel="stylesheet" type="text/css" href="/css/main.css" title="Basic Stylesheet" />

	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body>



<div class="page">

	<div class="socialicons">
		<a href="http://xona.com/rss.xml"><img src="/images/icons/32x32/rss.png" border="0"></a>
		<a href="https://discord.gg/cXV68sYkPG"><img src="/images/icons/32x32/discord.png" border="0"></a>
		<a href="http://twitter.com/XonaGames"><img src="/images/icons/32x32/twitter.png" border="0"></a>
		<a href="http://youtube.com/XonaGames"><img src="/images/icons/32x32/youtube.png" border="0"></a>
		<a href="http://facebook.com/xonagames"><img src="/images/icons/32x32/facebook.png" border="0"></a>
		<a href="http://en.wikipedia.org/wiki/Xona_Games"><img src="/images/icons/32x32/wikipedia.png" border="0"></a>
	</div>		

	<div class="header">
	
	
		<div class="title">
<!--
			<a href="/"><img src="/images/banners/Xona_Games_logo_9_-_HD_-_840x108_-_trimmed.png" border="0"></a><br>
-->
			<a href="/"><img src="/images/banners/Xona_Games_logo_9_-_HD_-_1680x215_-_trimmed.png" width="840" height="108" border="0"></a><br>
		</div>		

		<div class="subtitle">
<!--
			<a href="/">Home</a> ·
-->
			<a href="/games/">Games</a> ·
			<a href="/awards/">Awards</a> ·
			<a href="/about/">About</a> ·
<!--
			<a href="/learn/">Learn</a> ·
-->
			<a href="/blog/">Blog</a> ·
			<a href="/press/">Press Kit</a> ·
			<a href="/contact/">Contact</a>
		</div>		
	
	</div> <!-- header -->

	
	
	<div class="main">

		<div class="heading">
		
		<!-- page heading goes here -->

Visual C++ .NET Standard Edition - Free Optimizing Compiler
		</div>

		<!-- page content goes -->


<p>Tuesday, June 29, 2004<br />
By: <a href="http://xona.com/Jason Doucette/">Jason Doucette</a></p>
 <p><font color="#FF0000"><strong>February 24, 2007 Update:</strong></font> <font color="#000000"><a href="http://www.microsoft.com/downloads/details.aspx?familyid=69D2219F-CE82-46A5-8AEC-072BD4BB955E&amp;displaylang=en">Visual Studio .NET 2003 Service Pack 1</a> has been released.&nbsp; Since this <a href="http://support.microsoft.com/kb/918007">fixes Visual C++ 2003 Standard compiler bugs</a>, it begs the question:&nbsp; Should I: A. Upgrade Visual C++ 2003 Standard to SP1, and use the newly fixed&nbsp;<em>non</em>-optimizing compiler?&nbsp; B. Not upgrade to SP1, and continue using the <em>optimizing</em> compiler of Visual C++ Toolkit 2003?&nbsp; C. Upgrade to Visual C++ 2005 Express Edition, which contains an "enhanced version of the C/C++ optimizing compiler", which obsoletes all Visual C++ 2003 versions, except that it does not include ATL or MFC?&nbsp; D. Possibly trick the SP1 installer into upgrading the Visual C++ Toolkit 2003's optimizing compiler?&nbsp; Please <a href="http://xona.com/forums/viewtopic.php?t=752">follow / join the discussion on our forums</a>.</font></p>
<p><font color="#000000"><strong><font color="#FF0000">May 18, 2006 Update:</font></strong> The&nbsp;<a href="http://msdn2.microsoft.com/en-us/visualc/aa336490.aspx">Visual C++ Toolkit 2003</a>&nbsp;has been replaced with&nbsp;<a href="http://msdn.microsoft.com/vstudio/express/visualC/default.aspx">Visual C++ 2005 Express Edition</a>, which is also free.&nbsp; This page states, "Visual C++ 2005 Express Edition also contains an <em>enhanced version of the C/C++ optimizing compiler</em> for the fastest executables."&nbsp; This makes Visual C++ 2003 Standard and Visual C++ Toolkit 2003 obsolete, except that Visual C++ 2005 Express does not include ATL or MFC.&nbsp; Also, since it not desirable to upgrade Visual Studio during mid-project, you may still want the Visual C++ Toolkit 2003.&nbsp;&nbsp;Thus, we have it available for download off Uploading.com:</font></p><p><font color="#000000"><strong>Download:&nbsp;</strong> <a href="http://www.uploading.com/files/HNH73WB3/VCToolkitSetup(v1.01)(2004.07.06).zip.html">VCToolkitSetup(v1.01)(2004.07.06).zip</a>&nbsp;(Uploading.com)</font>
<br />
<strong>Download:</strong><strong>&nbsp;</strong> <a href="download/VCToolkitSetup_v1.01__2004.07.06_.zip">VCToolkitSetup(v1.01)(2004.07.06).zip</a>&nbsp;(Xona.com)
</p>
<p>&nbsp;</p>
<p>Anyone who has purchased&nbsp;<a href="http://www.amazon.com/gp/associates/link-types/marketplace.html?t=stephenhawkin-20&amp;asin=B000089GKV">Microsoft Visual C++ .NET Standard Edition</a>&nbsp;(version 2002 or 2003, a.k.a. version 7.0 or 7.1, and VC7), which is <em>much</em> cheaper (<a href="http://msdn.microsoft.com/howtobuy/visualc/default.aspx">estimated retail price: $109 USD</a>) than the entire Microsoft Visual Studio .NET Professional Edition package (<a href="http://msdn.microsoft.com/howtobuy/vstudio/default.aspx">estimated retail price: $799 USD</a>), has been annoyed that it does <em>not</em> come with the optimizing compiler.&nbsp; You need not worry anymore.&nbsp; Microsoft has released the <a href="http://msdn.microsoft.com/visualc/vctoolkit2003">Visual C++ Toolkit 2003</a>&nbsp;for free, which includes "<em>the same compiler and linker that ship with Visual Studio .NET 2003 Professional!</em>"</p>
<p>&nbsp;</p>
<p><strong><font size="5">How do I instruct Visual C++ .NET Standard to use the Optimizing Compiler?</font></strong></p>
<p>Download and install the Visual C++ Toolkit 2003.&nbsp; Take a look in the 'bin' directory from its install location:<br />
<em>C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin</em></p>
<p>You should see five files that start with 'c'; they are the compiler files:</p>
<p align="center"><img border="0" alt="" src="images/29_toolkit_c_files.png" width="675" height="398" /></p>
<ol>
<li>c1.dll
</li>
<li>c1xx.dll
</li>
<li>c2.dll
</li>
<li>cl.exe
</li>
<li>cl.exe.config
</li>
</ol>
<p>These are the files you want the GUI to use now, instead of the versions it is currently using.&nbsp; Take a look in the 'bin' directory of your Visual C++ .NET Standard Edition install location:<br />
<em>C:\Program Files\Microsoft Visual Studio .NET 2003\Vc7\bin</em></p>
<p>You should see these same five files.&nbsp; These are the files the GUI is currently using.&nbsp; There are <strong>two ways</strong> to instruct the GUI to use the files from the Toolkit:</p>
<ol>
<li><strong>Method One (preferred):</strong><br />
Go into Tools -&gt; Options... -&gt; Projects folder -&gt; VC++ Directories.&nbsp; Under 'Show directories for:', select 'Executable files'.&nbsp; Insert the Visual C++ Toolkit's bin directory (<em>C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin</em>) at the top, so these files are found&nbsp;<strong>first</strong> and used, when the GUI starts looking for them.<br />
<br />
</li>
<li><strong>Method Two:<br /></strong>Make a backup copy of the Visual C++ .NET Standard Edition files, and then overwrite them with the Visual C++ Toolkit files.&nbsp; The next time you compile, you will be using the optimizing compiler.&nbsp; I should note that on Brian Johnson's&nbsp;<a href="http://blogs.msdn.com/brianjo/archive/2004/04/17/115335.aspx">article regarding the Toolkit</a>,
 <a href="http://blogs.msdn.com/brianjo/archive/2004/04/17/115335.aspx#124759">Pheo</a> stated that it was not necessary to overwrite the c1*.* files.&nbsp; I have found overwriting them has causes no problems.&nbsp; If they ever do, you can restore the originals from the backup copies.
</li>
</ol><p>&nbsp;</p>
<p><strong><font size="5">The .NET Standard GUI still grays out the Optimizing Switches.</font></strong></p>
<p>You are going to find that Visual C++ .NET Standard's GUI is <em>still</em> going to have the optimizing compiler switches grayed out:</p>
<p align="center"><img border="0" alt="" src="images/29_msvc_optimization_switches.png" width="644" height="440" /></p>
<p>This is not a problem thanks to the '<strong>Command Line</strong>' option under the '<strong>C/C++</strong>' folder within this same window.&nbsp; Simply <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_compiler_options_listed_by_category.asp">look up the compiler options</a>, and add them here.&nbsp; Be sure that you add these to your <em>release</em> build, not your <em>debug</em> build.&nbsp; If you were to try this with the original non-optimizing compiler, it will complain about the unsupported switches.&nbsp; If it does not complain, then you are successfully using the optimizing compiler.
</p>
<p>&nbsp;</p>
<p><strong><font size="5">Purchase the <em>much cheaper</em> Visual C++ .NET Standard Edition</font></strong></p>
<p>There is now little reason to spend <em>eight times</em> the price for Visual Studio .NET Professional, when the optimizing compiler is <em>freely</em> available, and can be installed easily using my explanation above.</p>
<p></p><p align="center"><a href="http://www.amazon.com/gp/associates/link-types/marketplace.html?t=stephenhawkin-20&amp;asin=B000089GKV"><img border="0" alt="" src="images/29_vcpp_net_standard_2003.png" width="147" height="188" /><br />
Microsoft Visual C++ .NET<br />
Standard Edition 2003</a></p>
<p>&nbsp;</p>
<p><strong><font size="5">Which Additional Switches do you Recommend?</font></strong></p>
<p>Firstly, there are many optimization switches that are available via the GUI within Visual C++ .NET Standard Edition, such as <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.G.asp">/G7 (Optimize for Processor)</a>, which optimizes the code for the Pentium 4 and Athlon processors, but still creates an executable backwards compatible with older processors.&nbsp; I would recommend that you look through and see what you can change without requiring the manual addition of parameters to the command line.&nbsp; Once you have done this, I recommend the following for the command line:</p>
<ul>
<li><a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.O1.2c_2f.O2.asp">/O2 - Maximize Speed</a>:
This switch is identical to using the following switches:
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Og.asp">/Og</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Oi.asp">/Oi</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Os.asp">/Ot</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Oy.asp">/Oy</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Ob.asp">/Ob2</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Gs.asp">/Gs</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.GF.asp">/GF</a>,
and <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Gy.asp">/Gy</a>.&nbsp; This is set by default in the Professional Edition for release builds.&nbsp;
</li>
<li><a href="http://msdn.microsoft.com/library/en-us/vccore/html/vclrfArchMinimumCPUArchitecture.asp">/arch - Minimum CPU Architecture</a>: Use this if you know for certain the application will <em>only</em> be run on systems that minimally support Streaming SIMD Extensions (SSE) or Streaming SIMD Extensions 2 (SSE2).&nbsp; Note that the resultant executable will <em>not</em> run on a CPU that does not minimally support the instruction set you specify.
</li>
</ul>
<p>For further reading, the following two articles will give you some additional information on optimization switches, and what they accomplish:<?XML:NAMESPACE PREFIX = "CD" /?>
</p>
<ol>
<li><a href="http://msdn.microsoft.com/library/en-us/dv_vstechart/html/vctchOptimizingYourCodeWithVisualC.asp">Optimizing Your Code with Visual C++</a>
</li>
<li><a href="http://msdn.microsoft.com/library/en-us/dv_vstechart/html/optimization.asp">Visual C++ Optimization Overview</a>
</li>
</ol>
<p>&nbsp;</p>
<p><strong><font size="5">Problems and Recommendations</font></strong></p>
<p>In the Project -&gt; Properties, under Configuration Properties -&gt; General, there is a switch that is already enabled from the Standard Edition GUI called 'Whole Program Optimization'.&nbsp; It defaults to 'No', and the explanation text does not indicate any compiler switch that this selection may represent.&nbsp; I would assume that this represents the <a href="http://msdn.microsoft.com/library/en-us/vccore/html/vcgrfGLWholeProgramOptimization.asp">/GL (Whole Program Optimization) switch</a>.&nbsp; If you set the selection to 'Yes' and compile, you will notice in the build log that the GUI does not pass the /GL parameter to the compiler.&nbsp; If you want this switch (it is recommended for release builds), then you must add it manually to the command line parameters.&nbsp; In general, it is beneficial to look up each compiler switch to understand its effects, and it may be easier for some people to merely add them all to the command line manually.</p>
<p>&nbsp;</p>
<p><strong><font size="5">Minimizing Code Size</font></strong></p>
<p> When code size is a concern, you should use the <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.O1.2c_2f.O2.asp">/O1 (Minimize Size) switch</a>&nbsp;(which is identical to using the following switches:
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Og.asp">/Og</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Os.asp">/Os</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Oy.asp">/Oy</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Ob.asp">/Ob2</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Gs.asp">/Gs</a>,
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.GF.asp">/GF</a>,
and
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.Gy.asp">/Gy</a>).&nbsp;
For multithreaded applications, the most effective way to reduce the size of the resultant executable is to use the <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.MD.2c_2f.ML.2c_2f.MT.2c_2f.LD.asp">/MD (Use Run-Time Library) switch</a> which creates a multithreaded, dynamic linking executable file using <em>MSVCRT.LIB</em> (which requires the existence of <em>MSVCP71.DLL</em> to run), as opposed to using the regular <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.MD.2c_2f.ML.2c_2f.MT.2c_2f.LD.asp">/MT (Use Run-Time Library) switch</a> which creates a multithreaded, static linking executable file using <em>LIBCMT.LIB</em>.&nbsp; For an example of the decrease in executable size, my current project was reduced from 216 Kb to 144 Kb when I switched from /MD to /MT.</p>
<p> Please note that an application that is dependent on <em>MSVCP71.DLL</em> <a href="http://msdn.microsoft.com/library/en-us/vclib/html/_CRT_C_Run.2d.Time_Libraries.asp">must redistribute it in the directory containing the executable</a>.&nbsp; When you do this, the size of both the executable and the .dll file are likely larger than if you just used the regular <a href="http://msdn.microsoft.com/library/en-us/vccore/html/_core_.2f.MD.2c_2f.ML.2c_2f.MT.2c_2f.LD.asp">/MT (Use Run-Time Library) switch</a>.&nbsp; However, in the case of Visual C++ 6.0 users, the run-time library is installed by default on Windows 98 / Windows NT and above, so the .dll distribution is not required.</p>
<p>&nbsp;</p>
<p><strong><font size="5">Visual C++ 6.0 Users</font></strong></p>
<p>On a recent <a href="http://www.kvr-vst.com/forum/viewtopic.php?t=49262">K-v-R thread</a>,&nbsp; 'texture' and Stefan Kuhn mentioned a way to incorporate the optimizing compiler in Visual C++ 6.0 Standard Edition.&nbsp; The&nbsp;method to accomplish this is similar to the <em>first</em> method explained above (the addition of directory paths), except for one thing.&nbsp; The optimizing compiler needs access to its own <em>lib</em> and <em>include</em> folders (in addition to the <em>bin</em> directory) that were create during the install of the Visual C++ Toolkit 2003.&nbsp; Therefore, you need to add all three of these following directories to the appropriate directory lists:<br />
<em>C:\Program Files\Microsoft Visual C++ Toolkit 2003\bin<br />
C:\Program Files\Microsoft Visual C++ Toolkit 2003\lib<br />
C:\Program Files\Microsoft Visual C++ Toolkit 2003\include</em></p>
<p>
You can make the compiler aware of these folders by adding them to the <em>top</em> of the directory lists, so they are searched first.&nbsp; Do this by going into Tools -&gt; Options -&gt; Directories tab.&nbsp; Note that you will need to make a different selection under 'Show directories for:' each time you add a path.&nbsp; Add the <em>bin</em> directory to the 'Executable files', add the <em>lib</em> directory to the 'Library files', and add the <em>include</em> directory to the 'Include files'.&nbsp; You must ensure that you make these paths the <em>first path</em> in the list, so when the GUI seeks out its required files, it will find the files in these directories first, instead of the original files in the original locations. </p>
<p>&nbsp;</p>
<p><strong><font size="5">Visual C++ 6.0 Problems</font></strong></p>
<p> I advise you to read the K-v-R thread mentioned <a href="http://www.kvr-vst.com/forum/viewtopic.php?p=636743#636743">from this point onward</a>, as it mentions numerous potential difficulties you may run into.&nbsp; There is also a <a href="http://www.gamedev.net/community/forums/topic.asp?topic_id=220165">thread on GameDev.net</a> that you may like to read.&nbsp; I will summarize a few problems below, but I cannot guarantee that your programs will compile even if you take heed the points I mention.&nbsp; The best you can expect is that they will compile, but you will still lose the use of your debugger.&nbsp; I<strong>highly recommend</strong> upgrading to the cheap version of&nbsp; <a href="http://www.amazon.com/gp/associates/link-types/marketplace.html?t=stephenhawkin-20&amp;asin=B000089GKV">Microsoft Visual C++ .NET 2003 (VC7) Standard Edition</a>, as you will have no problems installing and using the optimizing compiler with it.</p>
<p> Stefan Kuhn has pointed out that if your program links to the multithreaded DLL run-time library (<em>MSVCRT.LIB</em>), there will be linking errors.&nbsp; Specifically, for any double to long conversions, the optimizing compiler will generate code that references the _ftol2 function.&nbsp; The linker will fail with the error: "unresolved external symbol __ftol2" (the extra underscore in the error report is due to "name mangling"; the compiler adds an underscore to exported / external function names).&nbsp; The solution is to link to the static C run-time library, instead of the multithreaded DLL run-time library.&nbsp;&nbsp;For multithreaded applications, this is <em>LIBCMTD.LIB</em> for debug mode, and <em>LIBCMT.LIB</em> for release mode (the multithreaded versions of <em>LIBCD.LIB</em> and&nbsp;<em>LIBC.LIB</em>, respectively).&nbsp; Ensure that you are linking to the static C run-time libraries for both debug and release builds.</p>
<p> When you compile for debug mode, calls to run-time checks will be inserted that reference functions beginning with __RTC.&nbsp; The linker will fail to link these functions if you are linking with the multithreaded DLL run-time library (<em>MSVCRTD.LIB</em>) or the multithreaded static C run-time library (<em>LIBCMTD.LIB</em>).</p>
<p> If your program is targeted for Windows ME or above (when <a href="http://msdn.microsoft.com/library/en-us/winprog/winprog/using_the_windows_headers.asp">WINVER has been set to 0x0500</a> or higher), you should not have these problems.&nbsp; However, if your program is targeted for Windows 98 or earlier (when <a href="http://msdn.microsoft.com/library/en-us/winprog/winprog/using_the_windows_headers.asp">WINVER has been set to a value below 0x0500</a>), the functions mentioned will <em>not</em> be implemented in certain run-time libraries, and the linker will complain if you attempt to use them.</p>
<p>
&nbsp;</p> 
<p>&nbsp;</p>
<p><strong>About the Author:</strong> I am <a href="http://xona.com/Jason Doucette/">Jason Doucette</a> of <a href="http://xona.com/">Xona Games</a>, an award-winning indie game studio that I founded with my <a href="../../staff/index.html">twin brother</a>. We make intensified arcade-style retro games. Our business, our games, our technology, and we as competitive gamers have won prestigious awards and received worldwide press. Our business has won $190,000 in contests. Our games have ranked from #1 in Canada to #1 in Japan, have become #1 best sellers in multiple countries, have won game contests, and have held 3 of the top 5 rated spots in Japan of all Xbox LIVE indie games. Our game engines have been awarded for technical excellence. And we, the developers, have placed #1 in competitive gaming competitions -- relating to the games we make. Read about <a href="../../about/index.html">our story</a>, <a href="../../awards/index.html">our awards</a>, <a href="../../games/index.html">our games</a>, and view <a href="../../blog/index.html">our blog</a>.</p>

	</div> <!-- main -->

	<div class="footer">

		&copy;
		<script language="JavaScript" type="text/javascript">
		<!--
		D=new Date;yy=D.getFullYear();document.write("1999.."+yy);
		// -->
		</script>
		<a href="http://xona.com/">Xona Games Inc.</a> All Rights Reserved
	</div> <!-- footer -->

</div> <!-- page -->

<!-- trackers start -->

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-767921-1";
urchinTracker();
</script>

<!-- trackers end -->


</body>
</html>

